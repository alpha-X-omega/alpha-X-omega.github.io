{
 "cells": [
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "*********************************************\n",
    "Secant Methods for Unconstrained Minimization\n",
    "*********************************************\n",
    "\n",
    "Implementation of Quasi-Newton Algorithms Using the Positive Definite Secant Update\n",
    "===================================================================================\n",
    "\n",
    "- Details to Mind\n",
    "\n",
    "  - Factored versus Unfactored\n",
    "  - Condition Number\n",
    "  - Positive Definite\n",
    "\n",
    "    - Trust Region versus Line Search\n",
    "\n",
    "  - Noise level of each component\n",
    "\n",
    "- Picking an Initial Jacobian\n",
    "\n",
    "  - Set it to a finite difference approximation.\n",
    "\n",
    "- Picking an Initial Hessian\n",
    "\n",
    "  .. math::\n",
    "\n",
    "     \\DeclareMathOperator{\\typ}{typ}\n",
    "     H_0 = \\max \\{ \\lvert f(x_0) \\rvert, \\typ f \\} \\cdot D_x^2."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 1\n",
    "==========\n",
    "\n",
    "The Hessian is symmetric by definition.\n",
    "See :ref:`Exercise 4.12 <dennis1996numerical-ex-4.12>` for more\n",
    "reasons why a secant approximation to a Hessian should be symmetric."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 2\n",
    "==========\n",
    "\n",
    "Suppose :math:`A, B \\in \\mathbb{R}^{n \\times n}` with :math:`B` symmetric.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\DeclareMathOperator{\\tr}{tr}\n",
    "   \\left\\Vert B - A \\right\\Vert_F^2\n",
    "    &= \\tr\\left(\n",
    "         \\left( B - A \\right)^\\top \\left( B - A \\right)\n",
    "       \\right)\\\\\n",
    "    &= \\tr\\left(B^\\top B\\right) - \\text{tr}\\left(B^\\top A\\right) -\n",
    "       \\tr\\left(A^\\top B\\right) +\n",
    "       \\tr\\left(A^\\top A\\right)\n",
    "       & \\quad & \\text{trace operator is a linear mapping}\\\\\n",
    "    &= \\tr\\left( B^2 \\right) -\n",
    "       2 \\tr\\left( AB \\right) +\n",
    "       \\tr\\left(A^\\top A\\right)\n",
    "       & \\quad & \\text{trace cyclic/transpose property}\n",
    "\n",
    "By inspection, this norm is minimized when :math:`B = A`, which is only valid\n",
    "when :math:`A` is also symmetric.\n",
    "\n",
    "From the results in (a) and (b), the norm can be rewritten as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert B - A \\right\\Vert_F^2\n",
    "    &= \\tr\\left( B^2 \\right) -\n",
    "       2 \\tr\\left( AB \\right) +\n",
    "       \\tr\\left( A^\\top A \\right)\\\\\n",
    "    &= \\tr\\left( B^2 \\right) -\n",
    "       \\tr\\left( \\left( A + A^\\top \\right) B \\right) +\n",
    "       \\tr\\left( A^\\top A \\right).\n",
    "\n",
    "Using matrix calculus to find the roots of the derivative gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\\partial \\left\\Vert B - A \\right\\Vert_F^2}{\\partial B}\n",
    "    &= \\tr\\left( \\frac{\\partial B^2}{\\partial B} \\right) -\n",
    "       \\tr\\left(\n",
    "         \\frac{\\partial \\left( A + A^\\top \\right) B}{\\partial B}\n",
    "       \\right) +\n",
    "       \\tr\\left( \\frac{\\partial A^\\top A}{\\partial B} \\right)\n",
    "       & \\quad & \\text{linear trace operator commutes with derivative}\\\\\n",
    "   0 &= 2B - A^\\top - A\\\\\n",
    "   \\frac{A + A^\\top}{2} &= B.\n",
    "\n",
    "This root is a minimum according to the second derivative test:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\\partial^2 \\left\\Vert B - A \\right\\Vert_F^2}{\\partial B^2}\n",
    "    &= \\frac{\\partial}{\\partial B} \\left( 2B - A^\\top - A \\right)\\\\\n",
    "    &= 2I\\\\\n",
    "    &\\succ 0.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    "A useful identity to recall is that for any symmetric matrix :math:`A`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   x^\\top A x = x^\\top \\frac{A + A^\\top}{2} x.\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\tr\\left( A B \\right)\n",
    "    &= \\tr\\left( A \\sum_{i = 1}^n \\lambda_i q_i q_i^\\top \\right)\n",
    "       & \\quad & \\text{eigendecomposition}\\\\\n",
    "    &= \\sum_{i = 1}^n \\lambda_i \\tr\\left( A q_i q_i^\\top \\right)\n",
    "       & \\quad & \\text{trace is a linear mapping}\\\\\n",
    "    &= \\sum_{i = 1}^n \\lambda_i \\tr\\left( q_i^\\top A q_i \\right)\n",
    "       & \\quad & \\text{trace cyclic property}\\\\\n",
    "    &= \\frac{1}{2} \\sum_{i = 1}^n \\lambda_i\n",
    "         \\tr\\left( q_i^\\top \\left( A + A^\\top \\right) q_i \\right)\n",
    "       & \\quad & \\text{(a)}\\\\\n",
    "    &= \\frac{1}{2} \\tr\\left( \\left( A + A^\\top \\right) B \\right)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. _dennis1996numerical-ex-9.3:\n",
    "\n",
    "Exercise 3\n",
    "==========\n",
    "\n",
    "Suppose :math:`H_c \\triangleq H` is symmetric, :math:`s_c \\triangleq s`\n",
    "and :math:`y_c \\triangleq y`.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\DeclareMathOperator{\\det}{det}\n",
    "   H_+ s\n",
    "    &= \\left(\n",
    "         H +\n",
    "         \\frac{\n",
    "           \\left( y - Hs \\right) s^\\top + s \\left( y - Hs \\right)^\\top\n",
    "         }{s^\\top s} -\n",
    "         \\frac{\\left( y - Hs \\right)^\\top s}{\\left( s^\\top s \\right)^2} s s^\\top\n",
    "       \\right) s\n",
    "       & \\quad & \\text{(9.1.3)}\\\\\n",
    "    &= Hs +\n",
    "       \\frac{ys^\\top - Hss^\\top + sy^\\top - ss^\\top H^\\top}{s^\\top s} s -\n",
    "       \\frac{y^\\top s - s^\\top H^\\top s}{\\left( s^\\top s \\right)^2} s s^\\top s\\\\\n",
    "    &= Hs + y - Hs +\n",
    "       \\frac{sy^\\top s - ss^\\top Hs - y^\\top ss + s^\\top H ss}{s^\\top s}\\\\\n",
    "    &= y\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "Define :math:`\\Sigma \\triangleq \\begin{bmatrix} \\sigma_1 & \\sigma_2\\\\\n",
    "\\sigma_3 & \\sigma_4 \\end{bmatrix}`.  According to :cite:`rheinboldtwcqnm`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ - H\n",
    "    &= \\begin{bmatrix} y - Hs & s \\end{bmatrix}\n",
    "         \\begin{bmatrix} \\sigma_1 & \\sigma_2\\\\ \\sigma_3 & \\sigma_4 \\end{bmatrix}\n",
    "         \\begin{bmatrix} \\left( y - Hs \\right)^\\top\\\\ s^\\top \\end{bmatrix}\\\\\n",
    "    &= \\begin{bmatrix}\n",
    "         \\sigma_1 \\left( y - Hs \\right) + \\sigma_3 s &\n",
    "         \\sigma_2 \\left( y - Hs \\right) + \\sigma_4 s\n",
    "       \\end{bmatrix}\n",
    "         \\begin{bmatrix} \\left( y - Hs \\right)^\\top\\\\ s^\\top \\end{bmatrix}\\\\\n",
    "    &= \\sigma_1 \\left( y - Hs \\right) \\left( y - Hs \\right)^\\top +\n",
    "       \\sigma_3 s \\left( y - Hs \\right)^\\top +\n",
    "       \\sigma_2 \\left( y - Hs \\right) s^\\top + \\sigma_4 s s^\\top\n",
    "\n",
    "where :math:`\\sigma_1 = 0`,\n",
    ":math:`\\sigma_2 = \\sigma_3 = \\left( s^\\top s \\right)^{-1}`, and\n",
    ":math:`\\sigma_4 =\n",
    "-\\frac{\\left( y - Hs \\right)^\\top s}{\\left( s^\\top s \\right)^2}`.\n",
    "\n",
    "By inspection, :math:`H_+ - H = \\left( H_+ - H \\right)^\\top`.\n",
    "\n",
    "When :math:`\\det(\\Sigma) = -\\left( s^\\top s \\right)^{-2} \\neq 0`,\n",
    ":math:`\\Sigma` is a full-rank matrix.  Applying (b.1) and (b.2) shows that\n",
    ":math:`H_+ - H` has a maximum rank of :math:`2`.\n",
    "\n",
    "(b.1)\n",
    "-----\n",
    "\n",
    "Recall the following rank property for a matrix\n",
    ":math:`A \\in \\mathbb{R}^{m \\times n}`:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\DeclareMathOperator{\\rank}{rank}\n",
    "   \\rank\\left( A^\\top A \\right) =\n",
    "   \\rank\\left( A A^\\top \\right) =\n",
    "   \\rank(A) =\n",
    "   \\rank\\left( A^\\top \\right).\n",
    "\n",
    "Define :math:`A \\triangleq \\begin{bmatrix} y - Hs & s \\end{bmatrix}`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   A^\\top A\n",
    "    &= \\begin{bmatrix} \\left( y - Hs \\right)^\\top\\\\ s^\\top \\end{bmatrix}\n",
    "         \\begin{bmatrix} y - Hs & s \\end{bmatrix}\\\\\n",
    "    &= \\begin{bmatrix}\n",
    "         \\left( y - Hs \\right)^\\top \\left( y - Hs \\right) &\n",
    "           \\left( y - Hs \\right) s\\\\\n",
    "         s^\\top \\left( y - Hs \\right) & s^\\top s\n",
    "       \\end{bmatrix}\n",
    "\n",
    "When :math:`\\det\\left( A^\\top A \\right) \\neq 0`, :math:`A` is full-rank.\n",
    "\n",
    "(b.2)\n",
    "-----\n",
    "\n",
    "Recall the following rank property for a matrix\n",
    ":math:`B \\in \\mathbb{R}^{n \\times k}`:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\rank(AB) \\leq \\min \\left\\{ \\rank(A), \\rank(B) \\right\\}.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\rank\\left( A \\Sigma A^\\top \\right)\n",
    "    &\\leq \\min \\left\\{ \\rank(A), \\rank\\left( \\Sigma A^\\top \\right) \\right\\}\\\\\n",
    "    &\\leq \\min \\left\\{\n",
    "            \\rank(A),\n",
    "            \\min \\left\\{ \\rank(\\Sigma), \\rank\\left( A^\\top \\right) \\right\\}\n",
    "          \\right\\}\\\\\n",
    "    &= \\min \\left\\{\n",
    "         \\rank(A), \\rank(\\Sigma), \\rank\\left( A^\\top \\right)\n",
    "       \\right\\}"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 4\n",
    "==========\n",
    "\n",
    "Define a linearly independent set\n",
    ":math:`S = \\left\\{ v_1 = s_c, v_2, \\ldots, v_n \\right\\}` where\n",
    ":math:`v_i \\in \\mathbb{R}^n` is randomly generated for :math:`2 \\leq i \\leq n`.\n",
    "\n",
    "Perform Gram-Schmidt orthonormalization to generate an orthonormal set\n",
    ":math:`Q = \\left\\{ q_1, q_2, \\ldots, q_n \\right\\}` where\n",
    ":math:`q_i = t_i \\left\\Vert t_i \\right\\Vert^{-1}` for :math:`1 \\leq i \\leq n`\n",
    "with\n",
    "\n",
    ".. math::\n",
    "\n",
    "   t_1 = v_1\n",
    "   \\quad \\text{and} \\quad\n",
    "   t_i = v_i - \\sum_{j = 1}^{i - 1} \\text{proj}_{t_j}(v_i).\n",
    "\n",
    "Suppose :math:`H - H_c` is a symmetric matrix with :math:`H s_c = y_c` where\n",
    ":math:`H_+` is given by (9.1.3) and :math:`H \\in \\mathbb{R}^{n \\times n}`.\n",
    "Applying the results of :ref:`Exercise 3.11 <dennis1996numerical-ex-3.11>` gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_+ - H_c \\right\\Vert_F^2\n",
    "    &= \\sum_{i = 1}^n\n",
    "         \\left\\Vert \\left( H_+ - H_c \\right) q_i \\right\\Vert_2^2\\\\\n",
    "    &\\leq \\sum_{i = 1}^n \\left\\Vert \\left( H - H_c \\right) q_i \\right\\Vert_2^2\n",
    "          & \\quad & \\text{(a) and (b)}\\\\\n",
    "   \\left\\Vert H_+ - H_c \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert H - H_c \\right\\Vert_F.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left( H_+ - H_c \\right) s_c\n",
    "    &= \\left(\n",
    "         \\frac{\n",
    "           \\left( y_c - H_c s_c \\right) s_c^\\top +\n",
    "           s_c \\left( y_c - H_c s_c \\right)^\\top\n",
    "         }{\n",
    "           s_c^\\top s_c\n",
    "         } -\n",
    "         \\frac{\n",
    "           \\left( y_c - H_c s_c \\right)^\\top s_c\n",
    "         }{\n",
    "           \\left( s_c^\\top s_c \\right)^2\n",
    "         } s_c s_c^\\top\n",
    "       \\right) s_c\n",
    "       & \\quad & \\text{(9.1.3)}\\\\\n",
    "    &= \\left(\n",
    "         \\frac{\n",
    "           \\left( H - H_c \\right) s_c s_c^\\top +\n",
    "           s_c s_c^\\top \\left( H - H_c \\right)\n",
    "         }{\n",
    "           s_c^\\top s_c\n",
    "         } -\n",
    "         \\frac{\n",
    "           s_c^\\top \\left( H - H_c \\right) s_c\n",
    "         }{\n",
    "           \\left( s_c^\\top s_c \\right)^2\n",
    "         } s_c s_c^\\top\n",
    "       \\right) s_c\n",
    "       & \\quad & \\text{see initial assumptions}\\\\\n",
    "    &= \\left( H - H_c \\right) s_c +\n",
    "       s_c \\frac{s_c^\\top \\left( H - H_c \\right) s_c}{s_c^\\top s_c} -\n",
    "       \\frac{s_c^\\top \\left( H - H_c \\right) s_c}{s_c^\\top s_c} s_c\\\\\n",
    "    &= \\left( H - H_c \\right) s_c\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "Let :math:`t \\in \\mathbb{R}^n` satisfy :math:`t^\\top s_c = 0`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left( H_+ - H_c \\right) t\n",
    "    &= \\left(\n",
    "         \\frac{\n",
    "           \\left( y_c - H_c s_c \\right) s_c^\\top +\n",
    "           s_c \\left( y_c - H_c s_c \\right)^\\top\n",
    "         }{s_c^\\top s_c} -\n",
    "         \\frac{\n",
    "           \\left( y_c - H_c s_c \\right)^\\top s_c\n",
    "         }{\n",
    "           \\left( s_c^\\top s_c \\right)^2\n",
    "         } s_c s_c^\\top\n",
    "       \\right) t\n",
    "       & \\quad & \\text{(9.1.3)}\\\\\n",
    "    &= \\frac{s_c \\left( y_c - H_c s_c \\right)^\\top t}{s_c^\\top s_c}\n",
    "       & \\quad & s_c^\\top t = 0\\\\\n",
    "    &= \\frac{s_c s_c^\\top \\left( H - H_c \\right) t}{s_c^\\top s_c}\n",
    "       & \\quad & \\text{see initial assumptions}\\\\\n",
    "   \\left\\Vert \\left( H_+ - H_c \\right) t \\right\\Vert_2\n",
    "    &= \\left\\Vert\n",
    "         \\frac{s_c s_c^\\top}{s_c^\\top s_c} \\left( H - H_c \\right) t\n",
    "       \\right\\Vert_2\\\\\n",
    "    &\\leq \\left\\Vert \\frac{s_c s_c^\\top}{s_c^\\top s_c} \\right\\Vert_F\n",
    "          \\left\\Vert \\left( H - H_c \\right) t \\right\\Vert_2\n",
    "          & \\quad & \\text{(3.1.16)}\\\\\n",
    "    &\\leq \\left\\Vert \\left( H - H_c \\right) t \\right\\Vert_2\n",
    "          & \\quad & \\text{(3.1.17)}"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. _dennis1996numerical-ex-9.5:\n",
    "\n",
    "Exercise 5\n",
    "==========\n",
    "\n",
    "Let :math:`H_+` be given by (9.1.3), :math:`H_* = \\nabla^2 f(x_*)`,\n",
    ":math:`P_c = I - s_c s_c^\\top / s_c^\\top s_c`, :math:`e_k \\triangleq x_k - x_*`,\n",
    "and the assumptions of Theorem 9.1.2 hold i.e.\n",
    ":math:`\\left\\Vert x_0 - x_* \\right\\Vert_2 < \\epsilon` and\n",
    ":math:`\\left\\Vert H_0 - H_* \\right\\Vert_F < \\delta`.\n",
    "\n",
    "The results of\n",
    ":ref:`Exercise 3.8 <dennis1996numerical-ex-3.8>`,\n",
    ":ref:`Exercise 8.7 <dennis1996numerical-ex-8.7>`, and\n",
    ":ref:`Exercise 4.7 <dennis1996numerical-ex-4.7>` will be useful in the\n",
    "derivation that follows.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ - H_*\n",
    "    &= H_c - H_* +\n",
    "       \\frac{\n",
    "         \\left( y_c - H_c s_c \\right) s_c^\\top +\n",
    "         s_c \\left( y_c - H_c s_c \\right)^\\top\n",
    "       }{\n",
    "         s_c^\\top s_c\n",
    "       } -\n",
    "       \\frac{\n",
    "         \\left( y_c - H_c s_c \\right)^\\top s_c\n",
    "       }{\n",
    "         \\left( s_c^\\top s_c \\right)^2\n",
    "       } s_c s_c^\\top\\\\\n",
    "   \\left\\Vert H_+ - H_* \\right\\Vert_F\n",
    "    &= \\left\\Vert\n",
    "         P_c (H_c - H_*) P_c +\n",
    "         \\frac{(y_c - H_* s_c) s_c^\\top}{s_c^\\top s_c} +\n",
    "         \\frac{s_c (y_c - H_* s_c)^\\top P_c}{s_c^\\top s_c}\n",
    "       \\right\\Vert_F\n",
    "       & \\quad \\text{(9.7.1)}\\\\\n",
    "    &\\leq \\left\\Vert P_c (H_c - H_*) P_c \\right\\Vert_F +\n",
    "          \\left\\Vert\n",
    "            \\frac{(y_c - H_* s_c) s_c^\\top}{s_c^\\top s_c}\n",
    "          \\right\\Vert_F +\n",
    "          \\left\\Vert\n",
    "            \\frac{s_c (y_c - H_* s_c)^\\top P_c}{s_c^\\top s_c}\n",
    "          \\right\\Vert_F\n",
    "          & \\quad \\text{Exercise 3.8}\\\\\n",
    "    &\\leq \\left\\Vert H_c - H_* \\right\\Vert_F\n",
    "            \\left\\Vert P_c \\right\\Vert_2^2 +\n",
    "          \\left\\Vert y_c - H_* s_c \\right\\Vert_2\n",
    "            \\left\\Vert \\frac{s_c}{s_c^\\top s_c} \\right\\Vert_2 +\n",
    "          \\left\\Vert \\frac{s_c}{s_c^\\top s_c} \\right\\Vert_2\n",
    "            \\left\\Vert y_c - H_* s_c \\right\\Vert_2\n",
    "            \\left\\Vert P_c \\right\\Vert_2\n",
    "          & \\quad & \\text{(3.1.15) and (3.1.17)}\\\\\n",
    "    &\\leq \\left\\Vert H_c - H_* \\right\\Vert_F +\n",
    "          2 \\left\\Vert y_c - H_* s_c \\right\\Vert_2\n",
    "            \\left\\Vert s \\right\\Vert_2^{-1}\n",
    "          & \\quad & \\text{Exercise 8.7}\\\\\n",
    "    &\\leq \\left\\Vert H_c - H_* \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert x_+ - x_* \\right\\Vert_2 +\n",
    "            \\left\\Vert x_c - x_* \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{Lemma 4.1.12 and Exercise 4.7}.\n",
    "\n",
    "Notice that in order to make the following derivations easier, :math:`2 \\gamma`\n",
    "was replaced with :math:`\\gamma` while the :math:`\\frac{1}{2}` factor was kept.\n",
    "Recursively expanding (9.7.2) yields\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_k - H_* \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert H_{k - 1} - H_* \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert e_k \\right\\Vert_2 + \\left\\Vert e_{k - 1} \\right\\Vert_2\n",
    "          \\right)\\\\\n",
    "    &\\leq \\left\\Vert H_0 - H_* \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left\\Vert e_k \\right\\Vert_2 +\n",
    "          \\frac{\\gamma}{2} \\left\\Vert e_0 \\right\\Vert_2 +\n",
    "          \\gamma \\sum_{j = 1}^{k - 1} \\left\\Vert e_j \\right\\Vert_2\\\\\n",
    "    &\\leq \\delta + \\gamma \\sum_{j = 0}^k \\left\\Vert e_j \\right\\Vert_2.\n",
    "\n",
    "If the summation is uniformly bounded above for all :math:`k`, then the sequence\n",
    ":math:`\\left\\{ \\left\\Vert H_k - H_* \\right\\Vert_F \\right\\}` will be bounded\n",
    "above i.e. :math:`\\lim_{k \\rightarrow \\infty} \\left\\Vert e_k \\right\\Vert_2 = 0`.\n",
    "\n",
    "According to Theorem 3.1.4, the symmetric secant method is well defined if\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_*^{-1} \\left( H_k - H_* \\right) \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert H_*^{-1} \\right\\Vert_F \\left\\Vert H_k - H_* \\right\\Vert_F\n",
    "          & \\quad & \\text{(3.1.10)}\\\\\n",
    "    &\\leq \\beta \\left\\Vert H_k - H_* \\right\\Vert_F\n",
    "          & \\quad & H_* \\text{ is nonsingular}\n",
    "\n",
    "is strictly less than :math:`1`.  If it does hold, then (3.1.20) states that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_k^{-1} \\right\\Vert_F \\leq\n",
    "   \\frac{\n",
    "     \\left\\Vert H_*^{-1} \\right\\Vert_F\n",
    "   }{\n",
    "     1 - \\left\\Vert H_*^{-1} \\left( H_k - H_* \\right) \\right\\Vert_F\n",
    "   }\n",
    "\n",
    "where\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_0^{-1} \\right\\Vert_F \\leq \\frac{\\beta}{1 - \\beta \\delta}.\n",
    "\n",
    "Suppose :math:`x_{k + 1}` is well defined.  Isolating :math:`e_{k + 1}`\n",
    "according to the derivation of (8.2.1) gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   x_{k + 1}\n",
    "    &= x_k - H_k^{-1} \\nabla f(x_k)\n",
    "       & \\quad & \\text{(9.1.4a)}\\\\\n",
    "   x_{k + 1} - x_*\n",
    "    &= x_k - x_* - H_k^{-1} \\left( \\nabla f(x_k) - \\nabla f(x_*) \\right)\n",
    "       & \\quad & \\nabla f(x_*) = 0\\\\\n",
    "   H_k e_{k + 1} &= H_k e_k - \\nabla f(x_k) + \\nabla f(x_*)\\\\\n",
    "    &= \\left( H_k - H_* \\right) e_k +\n",
    "       \\left( -\\nabla f(x_k) + \\nabla f(x_*) + H_* e_k \\right)\\\\\n",
    "   \\left\\Vert e_{k + 1} \\right\\Vert_2\n",
    "    &\\leq \\left\\Vert H_k^{-1} \\right\\Vert_F\n",
    "          \\left[\n",
    "            \\left\\Vert -\\nabla f(x_k) + \\nabla f(x_*) + H_* e_k \\right\\Vert_2 +\n",
    "            \\left\\Vert H_k - H_* \\right\\Vert_F \\left\\Vert e_k \\right\\Vert_2\n",
    "          \\right]\n",
    "          & \\quad & \\text{(3.1.16) and Exercise 3.4}\\\\\n",
    "    &\\leq \\left\\Vert H_k^{-1} \\right\\Vert_F\n",
    "          \\left[\n",
    "            \\frac{\\gamma}{2} \\left\\Vert e_k \\right\\Vert_2 +\n",
    "            \\left\\Vert H_k - H_* \\right\\Vert_F\n",
    "          \\right] \\left\\Vert e_k \\right\\Vert_2\n",
    "          & \\quad & \\text{Lemma 4.1.12 and (3.1.1b)}.\n",
    "\n",
    "See :ref:`Exercise 3.4 <dennis1996numerical-ex-3.4>` for more details.\n",
    "One (arbitrary yet simple) way to satisfy the definition of :math:`q`-linear\n",
    "convergence (2.3.1) is to define\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_k - H_* \\right\\Vert_F\n",
    "    &\\leq (2 - 2^{-k}) \\delta\n",
    "          & \\quad & \\text{(8.2.7)}\\\\\n",
    "   \\left\\Vert e_{k + 1} \\right\\Vert_2\n",
    "    &\\leq \\frac{1}{2} \\left\\Vert e_k \\right\\Vert_2\n",
    "          & \\quad & \\text{(8.2.8).}\n",
    "\n",
    "From the initial assumptions, the base case :math:`k = 0` for (8.2.7) is\n",
    "satisfied:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_0 - H_* \\right\\Vert_F \\leq\n",
    "   \\delta \\leq (2 - 2^{-0}) \\delta \\leq 2 \\delta.\n",
    "\n",
    "The base case :math:`k = 0` for (8.2.8) is also satisfied if :math:`\\epsilon`\n",
    "and :math:`\\delta` are chosen such that :math:`6 \\beta \\delta \\leq 1`\n",
    "and :math:`3 \\gamma \\epsilon \\leq 2 \\delta` where\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert e_{0 + 1} \\right\\Vert_2\n",
    "    &\\leq \\left\\Vert H_0^{-1} \\right\\Vert_F\n",
    "          \\left[\n",
    "            \\frac{\\gamma}{2} \\left\\Vert e_0 \\right\\Vert_2 +\n",
    "            \\left\\Vert H_0 - H_* \\right\\Vert_F\n",
    "          \\right] \\left\\Vert e_0 \\right\\Vert_2\\\\\n",
    "    &\\leq \\frac{\\beta}{1 - \\beta \\delta}\n",
    "          \\left[ \\frac{\\gamma}{2} \\epsilon + \\delta \\right] \\epsilon\\\\\n",
    "    &\\leq \\frac{6 \\beta}{5}\n",
    "          \\left[ \\frac{\\gamma}{2} \\epsilon + \\delta \\right] \\epsilon\\\\\n",
    "    &\\leq \\left[\n",
    "            \\frac{3 \\beta \\gamma \\epsilon}{5} + \\frac{6 \\beta \\delta}{5}\n",
    "          \\right] \\epsilon\\\\\n",
    "    &\\leq \\left[ \\frac{2 \\beta \\delta}{5} + \\frac{1}{5} \\right] \\epsilon\\\\\n",
    "    &\\leq \\left[ \\frac{1}{15} + \\frac{1}{5} \\right] \\epsilon\\\\\n",
    "    &\\leq \\frac{1}{2} \\epsilon.\n",
    "\n",
    "For the inductive step, assume (8.2.7) and (8.2.8) holds for\n",
    ":math:`k = 0, \\ldots, i - 1`.  When :math:`k = i`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_i - H_* \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert H_{i - 1} - H_* \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert e_i \\right\\Vert_2 + \\left\\Vert e_{i - 1} \\right\\Vert_2\n",
    "          \\right)\\\\\n",
    "    &\\leq (2 - 2^{-i - 1}) \\delta +\n",
    "          \\frac{3 \\gamma}{4} \\left\\Vert e_{i - 1} \\right\\Vert_2\\\\\n",
    "    &\\leq (2 - 2^{-i - 1}) \\delta + \\frac{3 \\gamma}{4} 2^{-(i - 1)} \\epsilon\\\\\n",
    "    &\\leq (2 - 2^{-i - 1}) \\delta + 2^{-i} \\delta\\\\\n",
    "    &\\leq (2 - 2^{-i}) \\delta.\n",
    "\n",
    "To complete the proof, it is necessary to show that the symmetric secant is\n",
    "well-defined:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_*^{-1} \\left( H_i - H_* \\right) \\right\\Vert_F\n",
    "    &\\leq \\beta \\left\\Vert H_i - H_* \\right\\Vert_F\n",
    "          & \\quad & \\text{see the foregoing derivation}\\\\\n",
    "    &\\leq \\beta (2 - 2^{-i}) \\delta\\\\\n",
    "    &\\leq 2 \\beta \\delta\\\\\n",
    "    &\\leq \\frac{1}{3}.\n",
    "\n",
    "Consequently, :math:`\\left\\Vert H_i^{-1} \\right\\Vert_F \\leq \\frac{3 \\beta}{2}`.\n",
    "Thus,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert e_{i + 1} \\right\\Vert_2\n",
    "    &\\leq \\left\\Vert H_i^{-1} \\right\\Vert_F\n",
    "          \\left[\n",
    "            \\frac{\\gamma}{2} \\left\\Vert e_i \\right\\Vert_2 +\n",
    "            \\left\\Vert H_i - H_* \\right\\Vert_F\n",
    "          \\right] \\left\\Vert e_i \\right\\Vert_2\\\\\n",
    "    &\\leq \\frac{3 \\beta}{2} \\left[\n",
    "            \\frac{\\gamma}{2} 2^{-i} \\epsilon +\n",
    "            (2 - 2^{-i}) \\delta\n",
    "          \\right] \\left\\Vert e_i \\right\\Vert_2\\\\\n",
    "    &\\leq \\frac{3 \\beta}{2} \\left[\n",
    "            \\frac{1}{3} 2^{-i} + (2 - 2^{-i})\n",
    "          \\right] \\delta \\left\\Vert e_i \\right\\Vert_2\\\\\n",
    "    &\\leq 3 \\beta \\delta \\left\\Vert e_i \\right\\Vert_2\\\\\n",
    "    &\\leq \\frac{1}{2} \\left\\Vert e_i \\right\\Vert_2."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. _dennis1996numerical-ex-9.6:\n",
    "\n",
    "Exercise 6\n",
    "==========\n",
    "\n",
    "The proof of :math:`q`-superlinear convergence is a combination of\n",
    ":ref:`Exercise 8.5 <dennis1996numerical-ex-8.5>` and page 183.\n",
    "\n",
    "Theorem 8.2.4 have shown that a sufficient condition for :math:`\\{ x_k \\}` to\n",
    "converge :math:`q`-superlinearly to :math:`x_*` is\n",
    ":math:`\\lim_{k \\rightarrow \\infty}\n",
    "\\frac{\\left\\Vert E_k s_k \\right\\Vert_2}{\\left\\Vert s_k \\right\\Vert_2} = 0`.\n",
    "\n",
    "Applying the results of :ref:`Exercise 8.7 <dennis1996numerical-ex-8.7>` and\n",
    ":ref:`Exercise 9.5 <dennis1996numerical-ex-9.5>` gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left\\Vert H_+ - H_* \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert P_c E_c P_c \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert x_+ - x_* \\right\\Vert_2 +\n",
    "            \\left\\Vert x_c - x_* \\right\\Vert_2\n",
    "          \\right)\\\\\n",
    "    &\\leq \\left\\Vert P_c \\right\\Vert_2 \\left\\Vert E_c P_c \\right\\Vert_F +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert x_+ - x_* \\right\\Vert_2 +\n",
    "            \\left\\Vert x_c - x_* \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{(3.1.15)}\\\\\n",
    "    &\\leq \\left\\Vert E_c \\right\\Vert_F -\n",
    "          \\left( 2 \\left\\Vert E_c \\right\\Vert_F \\right)^{-1}\n",
    "            \\left(\n",
    "              \\frac{\n",
    "                \\left\\Vert E_c s_c \\right\\Vert_2\n",
    "              }{\n",
    "                \\left\\Vert s_c \\right\\Vert_2\n",
    "              }\n",
    "            \\right)^2 +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert x_+ - x_* \\right\\Vert_2 +\n",
    "            \\left\\Vert x_c - x_* \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{Exercise 8.7 and Lemma 8.2.5}\\\\\n",
    "   \\left\\Vert E_{k + 1} \\right\\Vert_F\n",
    "    &\\leq \\left\\Vert E_k \\right\\Vert_F -\n",
    "          \\left( 2 \\left\\Vert E_k \\right\\Vert_F \\right)^{-1}\n",
    "            \\left(\n",
    "              \\frac{\n",
    "                \\left\\Vert E_k s_k \\right\\Vert_2\n",
    "              }{\n",
    "                \\left\\Vert s_k \\right\\Vert_2\n",
    "              }\n",
    "            \\right)^2 +\n",
    "          \\frac{\\gamma}{2} \\left(\n",
    "            \\left\\Vert e_{k + 1} \\right\\Vert_2 + \\left\\Vert e_k \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{replace subscripts}\\\\\n",
    "   \\frac{\\left\\Vert E_k s_k \\right\\Vert_2^2}{\\left\\Vert s_k \\right\\Vert_2^2}\n",
    "    &\\leq 2 \\left\\Vert E_k \\right\\Vert_F \\left(\n",
    "            \\left\\Vert E_k \\right\\Vert_F -\n",
    "            \\left\\Vert E_{k + 1} \\right\\Vert_F +\n",
    "            \\frac{3 \\gamma}{4} \\left\\Vert e_k \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{(8.2.8)}\\\\\n",
    "    &\\leq 4 (2 - 2^{-k}) \\delta \\left(\n",
    "            -2^{-(k + 1)} \\delta +\n",
    "            \\frac{3 \\gamma}{4} \\left\\Vert e_k \\right\\Vert_2\n",
    "          \\right)\n",
    "          & \\quad & \\text{(8.2.7)}\\\\\n",
    "    &\\leq 4 (2 - 2^{-k}) \\delta \\left(\n",
    "            -2^{-(k + 1)} \\delta +\n",
    "            \\frac{3 \\gamma}{4} 2^{-k} \\epsilon\n",
    "          \\right)\n",
    "          & \\quad & \\text{(8.2.8)}\\\\\n",
    "    &\\leq 4 (2 - 2^{-k}) \\delta \\left(\n",
    "            -2^{-(k + 1)} \\delta +\n",
    "            \\frac{2 \\delta}{4} 2^{-k}\n",
    "          \\right)\n",
    "          & \\quad & 3 \\gamma \\epsilon \\leq 2 \\delta\\\\\n",
    "    \\frac{\n",
    "      \\left\\Vert E_k s_k \\right\\Vert_2\n",
    "    }{\n",
    "      \\left\\Vert s_k \\right\\Vert_2\n",
    "    } &\\leq 0.\n",
    "\n",
    "Therefore\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\sum_{k = 0}^\\infty\n",
    "     \\frac{\\left\\Vert E_k s_k \\right\\Vert_2}{\\left\\Vert s_k \\right\\Vert_2}\n",
    "\n",
    "is finite, which satisfies the definition of :math:`q`-superlinear convergence."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 7\n",
    "==========\n",
    "\n",
    "The following proofs are combinations of :cite:`geijnrncf,grasmairmecf`.\n",
    "\n",
    "Recall that a matrix :math:`H \\in \\mathbb{R}^{n \\times n}` is symmetric positive\n",
    "definite if and only if it is symmetric and :math:`x^\\top H x > 0` for all\n",
    "nonzero vectors :math:`x \\in \\mathbb{R}^n`.\n",
    "\n",
    "(1)\n",
    "---\n",
    "\n",
    "Let :math:`H = J J^\\top` for some nonsingular\n",
    ":math:`J \\in \\mathbb{R}^{n \\times n}` (i.e. columns are linearly independent).\n",
    "Applying the results of (a) shows that :math:`H` is symmetric positive definite.\n",
    "\n",
    "\n",
    "(2)\n",
    "---\n",
    "\n",
    "Let :math:`H \\in \\mathbb{R}^{n \\times n}` be symmetric positive definite.\n",
    ":math:`H = J J^\\top` for some nonsingular :math:`J \\in \\mathbb{R}^{n \\times n}`\n",
    "can be satisfied if there exists a Cholesky factorization such that\n",
    ":math:`H = L L^\\top`.  Invoking (e) shows that :math:`H` has a Cholesky\n",
    "decomposition because it is symmetric positive definite.\n",
    "\n",
    "(a)\n",
    "^^^\n",
    "\n",
    "Let :math:`B \\in \\mathbb{R}^{m \\times n}` have linearly independent columns\n",
    "(i.e. full column rank) and :math:`A = B^\\top B`.  :math:`A` is symmetric\n",
    "because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   A^\\top = \\left( B^\\top B \\right)^\\top = B^\\top B = A.\n",
    "\n",
    "When :math:`x \\neq \\mathbf{0}`, the nullspace facts from\n",
    ":ref:`Exercise 6.17 <dennis1996numerical-ex-6.17>` shows that :math:`A` is also\n",
    "positive definite because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   v = Bx \\neq \\mathbf{0}\n",
    "   \\quad \\text{and} \\quad\n",
    "   v^\\top v = x^\\top B^\\top B x = x^\\top A x > 0.\n",
    "\n",
    "(b)\n",
    "^^^\n",
    "\n",
    "Let :math:`A \\in \\mathbb{R}^{n \\times n}` be symmetric positive definite.\n",
    "Define :math:`e_i` as a unit :math:`n`-vector whose entries are zero except for\n",
    "a one in the :math:`i^\\text{th}` entry.  Applying the definition of positive\n",
    "definite shows that the diagonal elements of :math:`A` are positive because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   e_i^\\top A e_i = \\alpha_{ii} > 0 \\text{ for } i = 1, 2, \\ldots, n.\n",
    "\n",
    "(c)\n",
    "^^^\n",
    "\n",
    "Let :math:`I_p` denote a :math:`p \\times p` identity matrix,\n",
    ":math:`I_q` denote a :math:`q \\times q` identity matrix, and\n",
    ":math:`M \\in \\mathbb{R}^{(p + q) \\times (p + q)}` such that\n",
    ":math:`M = \\begin{bmatrix} A & B\\\\ C & D \\end{bmatrix}` where\n",
    ":math:`A \\in \\mathbb{R}^{p \\times p}` is invertible,\n",
    ":math:`B \\in \\mathbb{R}^{p \\times q}`, :math:`C \\in \\mathbb{R}^{q \\times p}`,\n",
    "and :math:`D \\in \\mathbb{R}^{q \\times q}`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\begin{bmatrix} A & B\\\\ C & D \\end{bmatrix}\n",
    "     \\begin{bmatrix} I_p & -A^{-1}B\\\\ 0 & I_q \\end{bmatrix}\n",
    "    &= \\begin{bmatrix} A & 0\\\\ C & D - C A^{-1} B \\end{bmatrix}\\\\\n",
    "   \\begin{bmatrix} A & B\\\\ C & D \\end{bmatrix}\n",
    "    &= \\begin{bmatrix} A & 0\\\\ C & D - C A^{-1} B \\end{bmatrix}\n",
    "         \\begin{bmatrix} I_p & A^{-1}B\\\\ 0 & I_q \\end{bmatrix}\\\\\n",
    "    &= \\begin{bmatrix} I_p & 0\\\\ C A^{-1} & I_q \\end{bmatrix}\n",
    "         \\begin{bmatrix} A & 0\\\\ 0 & D - C A^{-1} B \\end{bmatrix}\n",
    "         \\begin{bmatrix} I_p & A^{-1}B\\\\ 0 & I_q \\end{bmatrix}\n",
    "\n",
    "(d)\n",
    "^^^\n",
    "\n",
    "Assume :math:`A \\in \\mathbb{R}^{(n + 1) \\times (n + 1)}` is symmetric positive\n",
    "definite.  Partition\n",
    "\n",
    ".. math::\n",
    "\n",
    "  A = \\begin{bmatrix} \\alpha_{11} & a_{21}^\\top\\\\ a_{21} & A_{22} \\end{bmatrix}\n",
    "\n",
    "where :math:`\\alpha_{11} \\in \\mathbb{R}^{1 \\times 1}`,\n",
    ":math:`a_{21} \\in \\mathbb{R}^{n \\times 1}`, and\n",
    ":math:`A_{22} \\in \\mathbb{R}^{n \\times n}`.  Applying (b) and (c) gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   A =\n",
    "   \\begin{bmatrix} \\alpha_{11} & \\mathbf{0}^\\top\\\\ a_{21} & S \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       I_1 & \\alpha_{11}^{-1} a_{21}^\\top\\\\\n",
    "       \\mathbf{0} & I_n\n",
    "     \\end{bmatrix}\n",
    "\n",
    "where :math:`S = A_{22} - a_{21} \\alpha_{11}^{-1} a_{21}^\\top` is the Schur\n",
    "complement of :math:`\\alpha_{11}` in :math:`A`.\n",
    "\n",
    ":math:`S` is symmetric by inspection.  For any non-zero vector\n",
    ":math:`x = \\begin{bmatrix} \\chi_0\\\\ x_n \\end{bmatrix} \\in \\mathbb{R}^{n + 1}`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   0 < x^\\top A x\n",
    "    &= \\begin{bmatrix} \\chi_0 & x_n^\\top \\end{bmatrix}\n",
    "         \\begin{bmatrix}\n",
    "           \\alpha_{11} & \\mathbf{0}^\\top\\\\ a_{21} & S\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix}\n",
    "           I_1 & \\alpha_{11}^{-1} a_{21}^\\top\\\\\n",
    "           \\mathbf{0} & I_n\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix} \\chi_0\\\\ x_n \\end{bmatrix}\\\\\n",
    "    &= \\begin{bmatrix}\n",
    "         \\chi_0 \\alpha_{11} + x_n^\\top a_{21} & x_n^\\top S\n",
    "       \\end{bmatrix}\n",
    "         \\begin{bmatrix}\n",
    "           \\chi_0 + \\alpha_{11}^{-1} a_{21}^\\top x_n\\\\\n",
    "           x_n\n",
    "         \\end{bmatrix}\\\\\n",
    "    &= \\chi_0^2 \\alpha_{11} + 2 \\chi_0 a_{21}^\\top x_n +\n",
    "       \\alpha_{11}^{-1} \\left( a_{21}^\\top x_n \\right)^2 + x_n^\\top S x_n.\n",
    "\n",
    "With respect to proving :math:`S` is positive definite, picking\n",
    ":math:`\\chi_0 = -\\alpha_{11}^{-1} a_{21}^\\top x_n` does not lose any generality\n",
    "because :math:`x_n` is any arbitrary nonzero vector.\n",
    "\n",
    "(e)\n",
    "^^^\n",
    "\n",
    "Let :math:`A \\in \\mathbb{R}^{(n + 1) \\times (n + 1)}` be symmetric positive\n",
    "definite.  Since :math:`A` is symmetric, let :math:`\\star` denote parts of\n",
    ":math:`A` that are neither stored nor updated.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\DeclareMathOperator{\\chol}{chol}\n",
    "   A = \\begin{bmatrix} \\alpha_{11} & \\star\\\\ a_{21} & A_{22} \\end{bmatrix}\n",
    "    &= L L^\\top\n",
    "       & \\quad & \\chol(A) = L\\\\\n",
    "    &= \\begin{bmatrix}\n",
    "         \\lambda_{11} & \\boldsymbol{0}^\\top\\\\\n",
    "         l_{21} & L_{22}\n",
    "       \\end{bmatrix}\n",
    "         \\begin{bmatrix}\n",
    "           \\lambda_{11} & l_{21}^\\top\\\\\n",
    "           \\boldsymbol{0} & L_{22}^\\top\n",
    "         \\end{bmatrix}\\\\\n",
    "    &= \\begin{bmatrix}\n",
    "         \\lambda_{11}^2 & \\star\\\\\n",
    "         \\lambda_{11} l_{21} & l_{21} l_{21}^\\top + L_{22} L_{22}^\\top\n",
    "       \\end{bmatrix}\n",
    "\n",
    "Equating the block matrices gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\lambda_{11} &= \\sqrt{\\alpha_{11}}\\\\\\\\\n",
    "   l_{21} &= a_{21} / \\lambda_{11}\\\\\\\\\n",
    "   L_{22} &= \\chol\\left( A_{22} - l_{21} l_{21}^\\top \\right).\n",
    "\n",
    "The inductive proof starts with the base case :math:`n = 0`: Invoking (b) shows\n",
    "that :math:`\\alpha_{11} > 0` hence\n",
    ":math:`\\lambda_{11} = \\sqrt{\\alpha_{11}}` is well-defined.\n",
    "\n",
    "The inductive step assumes the Cholesky factorization exist for all symmetric\n",
    "positive definite matrix :math:`A \\in \\mathbb{R}^{n \\times n}`.  Let\n",
    ":math:`A \\in \\mathbb{R}^{(n + 1) \\times (n + 1)}` be symmetric positive\n",
    "definite.  Partitioning :math:`A` as described and invoking (b) establishes that\n",
    ":math:`\\lambda_{11}` and :math:`l_{21}` are well-defined.  Invoking (d) reveals\n",
    "that :math:`L_{22}` is symmetric positive definite, which enables the recursive\n",
    "application of the decomposition.  Thus, :math:`L` is the desired Cholesky\n",
    "factor of :math:`A`."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 8\n",
    "==========\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ &= J_+ J_+^\\top\\\\\n",
    "    &= \\left( L_c + \\frac{(y_c - L_c v_c) v_c^\\top}{v_c^\\top v_c} \\right)\n",
    "       \\left( L_c + \\frac{(y_c - L_c v_c) v_c^\\top}{v_c^\\top v_c} \\right)^\\top\n",
    "       & \\quad & \\text{(9.2.6)}\\\\\n",
    "    &= H_c + \\frac{L_c v_c (y_c - L_c v_c)^\\top}{v_c^\\top v_c} +\n",
    "       \\frac{(y_c - L_c v_c) v_c^\\top L_c^\\top}{v_c^\\top v_c} +\n",
    "       \\frac{(y_c - L_c v_c) (y_c - L_c v_c)^\\top}{v_c^\\top v_c}\\\\\n",
    "    &= H_c + \\frac{y_c y_c^\\top}{v_c^\\top v_c} -\n",
    "       \\frac{L_c v_c v_c^\\top L_c^\\top}{v_c^\\top v_c}\\\\\n",
    "    &= H_c + \\frac{y_c y_c^\\top}{\\alpha^2 s_c^\\top H_c s_c} -\n",
    "       \\frac{H_c s_c s_c^\\top H_c}{s_c^\\top H_c s_c}\n",
    "       & \\quad & \\text{(9.2.8) and } H_c = L_c L_c^\\top\\\\\n",
    "    &= H_c + \\frac{y_c y_c^\\top}{y_c^\\top s_c} -\n",
    "       \\frac{H_c s_c s_c^\\top H_c}{s_c^\\top H_c s_c}\n",
    "       & \\quad & \\text{(9.2.9)}\n",
    "\n",
    "According to Lemma 8.3.1\n",
    "(see :ref:`Exercise 8.13 <dennis1996numerical-ex-8.13>`), :math:`J_+` given by\n",
    "(9.2.6, 9.2.9) is nonsingular."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "collapsed": true,
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 9\n",
    "==========\n",
    "\n",
    "Suppose :math:`H_c s_c = y_c`.  Then :math:`\\alpha = \\pm 1` and\n",
    "\n",
    ".. math::\n",
    "\n",
    "   J_+ &= L_c + \\frac{(y_c - L_c v_c) v_c^\\top}{v_c^\\top v_c}\n",
    "          & \\quad & \\text{(9.2.6)}\\\\\n",
    "    &= L_c + \\frac{y_c v_c^\\top}{v_c^\\top v_c} -\n",
    "       \\frac{L_c v_c v_c^\\top}{v_c^\\top v_c}\\\\\n",
    "    &= L_c + \\frac{y_c s_c^\\top L_c}{\\alpha s_c^\\top H_c s_c} -\n",
    "       \\frac{H_c s_c s_c^\\top L_c}{s_c^\\top H_c s_c}\n",
    "       & \\quad & \\text{(9.2.9)}\\\\\n",
    "    &= L_c + \\frac{y_c s_c^\\top L_c}{\\alpha y_c^\\top s_c} -\n",
    "       \\frac{y_c s_c^\\top L_c}{y_c^\\top s_c}\n",
    "       & \\quad & \\text{see initial supposition.}\n",
    "\n",
    "Thus choosing :math:`\\alpha = 1` makes :math:`J_+` closer to :math:`L_c` when\n",
    ":math:`y_c \\cong H_c s_c`."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 10\n",
    "===========\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+^{-1} &= J_+^{-\\top} J_+^{-1}\\\\\n",
    "    &= \\left(\n",
    "         L_c^{-\\top} + \\frac{(s_c - L_c^{-\\top} w_c) w_c^\\top}{w_c^\\top w_c}\n",
    "       \\right)\n",
    "       \\left(\n",
    "         L_c^{-1} + \\frac{w_c (s_c - L_c^{-\\top} w_c)^\\top}{w_c^\\top w_c}\n",
    "       \\right)\n",
    "       & \\quad & \\text{(9.2.12)}\\\\\n",
    "    &= H_c^{-1} +\n",
    "       \\frac{L_c^{-\\top} w_c (s_c - L_c^{-\\top} w_c)^\\top}{w_c^\\top w_c} +\n",
    "       \\frac{(s_c - L_c^{-\\top} w_c) w_c^\\top L_c^{-1}}{w_c^\\top w_c} +\n",
    "       \\frac{\n",
    "         (s_c - L_c^{-\\top} w_c) (s_c - L_c^{-\\top} w_c)^\\top\n",
    "       }{\n",
    "         w_c^\\top w_c\n",
    "       }\\\\\n",
    "    &= H_c^{-1} + \\frac{s_c s_c^\\top}{w_c^\\top w_c} -\n",
    "       \\frac{L_c^{-\\top} w_c w_c^\\top L_c^{-1}}{w_c^\\top w_c}\\\\\n",
    "    &= H_c^{-1} + \\frac{s_c s_c^\\top}{\\alpha^2 y_c^\\top H_c^{-1} y_c} -\n",
    "       \\frac{H_c^{-1} y_c y_c^\\top H_c^{-1}}{y_c^\\top H_c^{-1} y_c}\\\\\n",
    "    &= H_c^{-1} + \\frac{s_c s_c^\\top}{s_c^\\top y_c} -\n",
    "       \\frac{H_c^{-1} y_c y_c^\\top H_c^{-1}}{y_c^\\top H_c^{-1} y_c}\n",
    "\n",
    "where\n",
    "\n",
    ".. math::\n",
    "\n",
    "   w_c =\n",
    "   \\left( \\frac{y_c^\\top s_c}{y_c^\\top H_c^{-1} y_c} \\right)^{1 / 2}\n",
    "     L_c^{-1} y_c =\n",
    "   \\alpha L_c^{-1} y_c.\n",
    "\n",
    "Using lemma 8.3.1 to invert (9.2.12) gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   J_+^{\\top}\n",
    "    &= \\left(\n",
    "         L_c^{-\\top} + \\frac{(s_c - L_c^{-\\top} w_c) w_c^\\top}{w_c^\\top w_c}\n",
    "       \\right)^{-1}\\\\\n",
    "    &= L_c^\\top - \\sigma^{-1} L_c^\\top\n",
    "       \\frac{(s_c - L_c^{-\\top} w_c) w_c^\\top}{w_c^\\top w_c} L_c^\\top\\\\\n",
    "    &= L_c^\\top - L_c^\\top\n",
    "       \\frac{(s_c - L_c^{-\\top} w_c) w_c^\\top}{w_c^\\top L_c^\\top s_c} L_c^\\top\\\\\n",
    "    &= L_c^\\top -\n",
    "       \\frac{\n",
    "         L_c^\\top s_c w_c^\\top L_c^\\top - w_c w_c^\\top L_c^\\top\n",
    "       }{w_c^\\top L_c^\\top s_c}\\\\\n",
    "    &= L_c^\\top -\n",
    "       \\frac{\n",
    "         L_c^\\top s_c y_c^\\top - \\alpha L_c^{-1} y_c y_c^\\top\n",
    "       }{y_c^\\top s_c}\n",
    "\n",
    "where\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\sigma =\n",
    "   1 + \\frac{w_c^\\top}{w_c^\\top w_c} L_c^\\top (s_c - L_c^{-\\top} w_c) =\n",
    "   \\frac{w_c^\\top L_c^\\top s_c}{w_c^\\top w_c}.\n",
    "\n",
    "Consequently,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ &= J_+ J_+^\\top\\\\\n",
    "    &= \\left(\n",
    "         L_c -\n",
    "         \\frac{y_c s_c^\\top L_c - \\alpha y_c y_c^\\top L_c^{-\\top}}{y_c^\\top s_c}\n",
    "       \\right)\n",
    "       \\left(\n",
    "         L_c^\\top -\n",
    "         \\frac{\n",
    "           L_c^\\top s_c y_c^\\top - \\alpha L_c^{-1} y_c y_c^\\top\n",
    "         }{\n",
    "           y_c^\\top s_c\n",
    "         }\n",
    "       \\right)\\\\\n",
    "    &= H_c -\n",
    "       \\frac{H_c s_c y_c^\\top - \\alpha y_c y_c^\\top}{y_c^\\top s_c} -\n",
    "       \\frac{y_c s_c^\\top H_c - \\alpha y_c y_c^\\top}{y_c^\\top s_c} +\n",
    "       \\frac{\n",
    "         y_c s_c^\\top H_c s_c y_c^\\top - \\alpha y_c s_c^\\top y_c y_c^\\top -\n",
    "         \\alpha y_c y_c^\\top s_c y_c^\\top +\n",
    "         \\alpha^2 y_c y_c^\\top H_c^{-1} y_c y_c^\\top\n",
    "       }{\n",
    "         (y_c^\\top s_c)^2\n",
    "       }\\\\\n",
    "    &= H_c +\n",
    "       \\frac{y_c y_c^\\top - H_c s_c y_c^\\top - y_c s_c^\\top H_c}{y_c^\\top s_c} +\n",
    "       \\frac{y_c s_c^\\top H_c s_c y_c^\\top}{(y_c^\\top s_c)^2}\\\\\n",
    "    &= H_c +\n",
    "       \\frac{\n",
    "         (y_c - H_c s_c) y_c^\\top + y_c (y_c - H_c s_c)^\\top\n",
    "       }{\n",
    "         y_c^\\top s_c\n",
    "       } -\n",
    "       \\frac{(y_c - H_c s_c)^\\top s_c y_c y_c^\\top}{(y_c^\\top s_c)^2}."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 11\n",
    "===========\n",
    "\n",
    "Define :math:`H = T^\\top T`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\hat{H}_+\n",
    "    &= \\hat{H}_c +\n",
    "       \\frac{\n",
    "         (\\hat{y}_c - \\hat{H}_c \\hat{s}_c) \\hat{s}_c^\\top +\n",
    "         \\hat{s}_c (\\hat{y}_c - \\hat{H}_c \\hat{s}_c)^\\top\n",
    "       }{\n",
    "         \\hat{s}_c^\\top \\hat{s}_c\n",
    "       } -\n",
    "       \\frac{\n",
    "         (\\hat{y}_c - \\hat{H}_c \\hat{s}_c)^\\top\n",
    "         \\hat{s}_c \\hat{s}_c \\hat{s}_c^\\top\n",
    "       }{\n",
    "         (\\hat{s}_c^\\top \\hat{s}_c)^2\n",
    "       }\n",
    "       & \\quad & \\text{(9.3.1)}\\\\\n",
    "    &= T^{-\\top} H_c T^{-1} +\n",
    "       \\frac{\n",
    "         (T^{-\\top} y_c - T^{-\\top} H_c s_c) s_c^\\top T^\\top +\n",
    "         T s_c (y_c^\\top T^{-1} - s_c^\\top H_c T^{-1})\n",
    "       }{s_c^\\top H s_c} -\n",
    "       \\frac{\n",
    "         (y_c^\\top - s_c^\\top H_c) s_c T s_c s_c^\\top T^\\top\n",
    "       }{(s_c^\\top H s_c)^2}\\\\\n",
    "   H_+\n",
    "    &= H_c +\n",
    "       \\frac{\n",
    "         (y_c - H_c s_c) s_c^\\top H +\n",
    "         H s_c (y_c - H_c s_c)^\\top\n",
    "       }{s_c^\\top H s_c} -\n",
    "       \\frac{\n",
    "         (y_c - H_c s_c)^\\top s_c H s_c s_c^\\top H\n",
    "       }{(s_c^\\top H s_c)^2}\n",
    "       & \\quad & H_+ = T^\\top \\hat{H}_+ T."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. _dennis1996numerical-ex-9.12:\n",
    "\n",
    "Exercise 12\n",
    "===========\n",
    "\n",
    "The section on *Convergence of Double-Rank Methods* in :cite:`broyden1973local`\n",
    "is the proof for this exercise.  Overall, the proofs in paper were along the\n",
    "lines of the book's."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 13\n",
    "===========\n",
    "\n",
    "Suppose the assumptions of (9.3.1) holds\n",
    "(see :ref:`Exercise 7.2 <dennis1996numerical-ex-7.2>`).\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\hat{H}_+\n",
    "    &= \\hat{H}_c +\n",
    "       \\frac{\\hat{y}_c \\hat{y}_c^\\top}{\\hat{y}_c^\\top \\hat{s}_c} -\n",
    "       \\frac{\n",
    "         \\hat{H}_c \\hat{s}_c \\hat{s}_c^\\top \\hat{H}_c\n",
    "       }{\n",
    "         \\hat{s}_c^\\top \\hat{H}_c \\hat{s}_c\n",
    "       }\n",
    "       & \\quad & \\text{(9.2.10)}\\\\\n",
    "    &= T^{-\\top} H_c T^{-1} +\n",
    "       \\frac{T^{-\\top} y_c y_c^\\top T^{-1}}{y_c^\\top s_c} -\n",
    "       \\frac{T^{-\\top} H_c s_c s_c^\\top H_c T^{-1}}{s_c^\\top H_c s_c}\\\\\n",
    "    &= T^{-\\top} H_+ T^{-1}\n",
    "\n",
    "Applying the foregoing result to (9.2.11a) gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\hat{x}_{k + 1} &= \\hat{x}_k - \\hat{H}_k^{-1} \\nabla \\hat{f}(\\hat{x}_k)\\\\\n",
    "   T x_{k + 1}\n",
    "    &= T x_k -\n",
    "       \\left( T^{-\\top} H_k T^{-1} \\right)^{-1} T^{-\\top} \\nabla f(x_k)\\\\\n",
    "   T x_{k + 1} &= T x_k - T H_k^{-1} \\nabla f(x_k)\\\\\n",
    "   x_{k + 1} &= x_k - H_k^{-1} \\nabla f(x_k),\n",
    "\n",
    "which illustrates that the positive definite secant update is invariant under\n",
    "linear transformations of the variable space.\n",
    "\n",
    "As shown in :ref:`Exercise 4.11 <dennis1996numerical-ex-4.11>`,\n",
    ":math:`\\hat{H}_+` cannot be factored such that :math:`T^{-\\top} H_+ T^{-1}`\n",
    "is the original symmetric secant update where :math:`H_+`.\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "Recall that Broyden's update or simply the secant update :math:`(8.1.5)` applied\n",
    "to Hessians (9.1.2) is not guaranteed to be symmetric.  Its update has a rank\n",
    "of one by definition of rank and outer product.\n",
    "\n",
    "The update\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\hat{H}_+\n",
    "    &= \\hat{H}_c +\n",
    "       \\frac{\n",
    "         (\\hat{y}_c - \\hat{H}_c \\hat{s}_c) \\hat{s}_c^\\top\n",
    "       }{\n",
    "         \\hat{s}_c^\\top \\hat{s}_c\n",
    "       }\\\\\n",
    "    &= T^{-\\top} H_c T^{-1} +\n",
    "       \\frac{\n",
    "         (T^{-\\top} y_c - T^{-\\top} H_c s_c) s_c T^\\top\n",
    "       }{\n",
    "         s_c^\\top T^\\top T s_c\n",
    "       }\n",
    "\n",
    "can be modified to be invariant under linear transformations of the variable\n",
    "space as follows:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\hat{H}_+\n",
    "    &= \\hat{H}_c +\n",
    "       \\frac{\n",
    "         (\\hat{y}_c - \\hat{H}_c \\hat{s}_c) \\hat{y}_c^\\top\n",
    "       }{\n",
    "         \\hat{y}_c^\\top \\hat{s}_c\n",
    "       }\\\\\n",
    "    &= T^{-\\top} H_c T^{-1} +\n",
    "       \\frac{(T^{-\\top} y_c - T^{-\\top} H_c s_c) y_c T^{-1}}{y_c s_c}\\\\\n",
    "    &= T^{-\\top} H_+ T^{-1}\n",
    "\n",
    "which is essentially (8.4.5) with :math:`v_k = y_c`."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 14\n",
    "===========\n",
    "\n",
    "Let :math:`f(x_1, x_2) = x_1^2 + 2 x_1 x_2 + 2 x_2^2 + x_2^4`.  Then\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\nabla f\n",
    "    &= \\begin{bmatrix} 2 x_1 + 2 x_2\\\\ 2 x_1 + 4 x_2 + 4 x_2^3 \\end{bmatrix}\\\\\\\\\n",
    "   \\nabla^2 f\n",
    "    &= \\begin{bmatrix} 2 & 2\\\\ 2 & 4 + 12 x_2^2 \\end{bmatrix}.\n",
    "\n",
    "Suppose :math:`x_0 = (1, -1)^\\top`, then\n",
    ":math:`\\nabla f(x_0) = \\begin{bmatrix} 0\\\\ -6 \\end{bmatrix}` and\n",
    ":math:`H_0 = \\nabla^2 f(x_0) = \\begin{bmatrix} 2 & 2\\\\ 2 & 16 \\end{bmatrix}`.\n",
    "\n",
    "The positive definite secant and symmetric secant methods have in common the\n",
    "following updates:\n",
    "\n",
    ".. math::\n",
    "\n",
    "   x_{k + 1} &= x_k - H_k^{-1} \\nabla f(x_k)\\\\\\\\\n",
    "   s_k &= x_{k + 1} - x_k\\\\\\\\\n",
    "   y_k &= \\nabla f(x_{k + 1}) - \\nabla f(x_k).\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    "Suppose :math:`f \\colon \\mathbb{R}^n \\rightarrow \\mathbb{R}` and\n",
    ":math:`\\nabla f(x) = \\begin{bmatrix} A x + b\\\\ F(x) \\end{bmatrix}` where\n",
    ":math:`A \\in \\mathbb{R}^{m \\times n}`, :math:`b \\in \\mathbb{R}^m`, and\n",
    ":math:`F \\colon \\mathbb{R}^n \\rightarrow \\mathbb{R}^{n - m}` is nonlinear.\n",
    "\n",
    "Let :math:`z_k = F(x_{k + 1}) - F(x_k)` and\n",
    ":math:`s_k = \\begin{bmatrix} s_{k1}\\\\ s_{k2} \\end{bmatrix}` where\n",
    ":math:`s_{k1} \\in \\mathbb{R}^m` and :math:`s_{k2} \\in \\mathbb{R}^{n - m}`\n",
    "in order to simplify notations.\n",
    "\n",
    ":math:`H_0 = H(x_0)` can be calculated using finite difference or analytically\n",
    "as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H = \\nabla^2 f(x) &= \\frac{\\partial \\nabla f(x)}{\\partial x}\\\\\n",
    "    &= \\begin{bmatrix} A\\\\ F'(x) \\end{bmatrix}\n",
    "       & \\quad & \\frac{\\partial F(x)}{\\partial x} = F'(x) \\in\n",
    "                 \\mathbb{R}^{(n - m) \\times n}\\\\\n",
    "    &= H^\\top\n",
    "       & \\quad & \\text{(9.2.10) is a symmetric matrix of rank at most two.}\n",
    "\n",
    "As shown in :ref:`Exercise 8.10 <dennis1996numerical-ex-8.10>`, the affine\n",
    "transformation :math:`Ax_k + b = 0` for all :math:`k \\geq 1`.\n",
    "\n",
    "Substituting the given values into (a.1) shows that the positive definite secant\n",
    "method converges to the correct Hessian.  (a.2) illustrates that the symmetric\n",
    "secant method in this case fails to converge to the correct Hessian.  Note that\n",
    "this way of showing convergence is handwavy; the more rigorous version is along\n",
    "the lines of Exercises :ref:`5 <dennis1996numerical-ex-9.5>`,\n",
    ":ref:`6 <dennis1996numerical-ex-9.6>`, and\n",
    ":ref:`12 <dennis1996numerical-ex-9.12>`.\n",
    "See :ref:`Exercise 8.10 <dennis1996numerical-ex-8.10>` for a general idea of how\n",
    "to prove this.  Supposely :cite:`schnabelqnu82`, which could not be found on the\n",
    "internet, contains the proof.\n",
    "\n",
    "(a.1)\n",
    "^^^^^\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_1 &= H_0 + \\frac{y_0 y_0^\\top}{y_0^\\top s_0} -\n",
    "          \\frac{H_0 s_0 s_0^\\top H_0}{s_0^\\top H_0 s_0}\\\\\n",
    "    &= \\begin{bmatrix} A\\\\ F'(x_0) \\end{bmatrix} +\n",
    "       \\frac{\n",
    "         \\begin{bmatrix} A s_0\\\\ z_0 \\end{bmatrix}\n",
    "         \\begin{bmatrix} A s_0\\\\ z_0 \\end{bmatrix}^\\top\n",
    "       }{\n",
    "         \\begin{bmatrix} A s_0\\\\ z_0 \\end{bmatrix}^\\top s_0\n",
    "       } -\n",
    "       \\frac{\n",
    "         \\begin{bmatrix} A s_0\\\\ F'(x_0) s_0 \\end{bmatrix}\n",
    "         \\begin{bmatrix} s_0^\\top A^\\top\\\\ s_0^\\top F'(x_0)^\\top \\end{bmatrix}\n",
    "       }{\n",
    "         \\begin{bmatrix} A s_0\\\\ F'(x_0) s_0 \\end{bmatrix}^\\top s_0\n",
    "       }\\\\\n",
    "    &= \\begin{bmatrix} A\\\\ F'(x_0) \\end{bmatrix} +\n",
    "       (s_0^\\top A^\\top s_{01} + z_0^\\top s_{02})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           A s_0 s_0^\\top A^\\top & A s_0 z_0^\\top\\\\\n",
    "           z_0 s_0^\\top A^\\top & z_0 z_0^\\top\n",
    "         \\end{bmatrix} -\n",
    "       (s_0^\\top A^\\top s_{01} + s_0^\\top F'(x_0)^\\top s_{02})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           A s_0 s_0^\\top A^\\top & A s_0 s_0^\\top F'(x_0)^\\top\\\\\n",
    "           F'(x_0) s_0 s_0^\\top A^\\top & F'(x_0) s_0 s_0^\\top F'(x_0)^\\top\n",
    "         \\end{bmatrix}\n",
    "\n",
    "Generalizing this update sequence gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_{k + 1}\n",
    "    &= H_k + \\frac{y_k y_k^\\top}{y_k^\\top s_k} -\n",
    "       \\frac{H_k s_k s_k^\\top H_k}{s_k^\\top H_k s_k}\\\\\n",
    "    &= H_k +\n",
    "       (s_k^\\top A^\\top s_{k1} + z_k^\\top s_{k2})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           A s_k s_k^\\top A^\\top & A s_k z_k^\\top\\\\\n",
    "           z_k s_k^\\top A^\\top & z_k z_k^\\top\n",
    "         \\end{bmatrix} -\n",
    "       (s_k^\\top A^\\top s_{k1} + s_k^\\top F'(x_k)^\\top s_{k2})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           A s_k s_k^\\top A^\\top & A s_k s_k^\\top F'(x_k)^\\top\\\\\n",
    "           F'(x_k) s_k s_k^\\top A^\\top & F'(x_k) s_k s_k^\\top F'(x_k)^\\top\n",
    "         \\end{bmatrix}\\\\\n",
    "    &= H_k +\n",
    "       (z_k^\\top s_{k2})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{m \\times m} & \\boldsymbol{0}_{m \\times (n - m)}\\\\\n",
    "           \\boldsymbol{0}_{(n - m) \\times m} & z_k z_k^\\top\n",
    "         \\end{bmatrix} -\n",
    "       (s_k^\\top F'(x_k)^\\top s_{k2})^{-1}\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{m \\times m} & \\boldsymbol{0}_{m \\times (n - m)}\\\\\n",
    "           \\boldsymbol{0}_{(n - m) \\times m} & F'(x_k) s_k s_k^\\top F'(x_k)^\\top\n",
    "         \\end{bmatrix}.\n",
    "\n",
    "Notice how the remaining block matrices form another positive definite secant\n",
    "update, which still satisfies Theorem 9.3.1 according to the Schur complement.\n",
    "\n",
    "(a.2)\n",
    "^^^^^\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_1\n",
    "    &= H_0 +\n",
    "       \\frac{\n",
    "         (y_0 - H_0 s_0) s_0^\\top + s_0 (y_0 - H_0 s_0)^\\top\n",
    "       }{\n",
    "         s_0^\\top s_0\n",
    "       } -\n",
    "       \\frac{(y_0 - H_0 s_0)^\\top s_0 s_0 s_0^\\top}{(s_0^\\top s_0)^2}\\\\\n",
    "    &= \\begin{bmatrix} A\\\\ F'(x_0) \\end{bmatrix} +\n",
    "       \\frac{\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{m \\times 1}\\\\\n",
    "           z_0 - F'(x_0) s_0\n",
    "         \\end{bmatrix} s_0^\\top +\n",
    "         s_0 \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{1 \\times m} & z_0^\\top - s_0^\\top F'(x_0)^\\top\n",
    "         \\end{bmatrix}\n",
    "       }{\n",
    "         s_0^\\top s_0\n",
    "       } -\n",
    "       \\frac{\n",
    "         \\left( z_0^\\top - s_0^\\top F'(x_0)^\\top \\right) s_{02}\n",
    "       }{\n",
    "         (s_0^\\top s_0)^2\n",
    "       } s_0 s_0^\\top\\\\\n",
    "    &= \\begin{bmatrix} A\\\\ F'(x_0) \\end{bmatrix} +\n",
    "       \\frac{\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{m \\times n}\\\\\n",
    "           z_0 s_0^\\top - F'(x_0) s_0 s_0^\\top\n",
    "         \\end{bmatrix} +\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{n \\times m} &\n",
    "             s_0 z_0^\\top - s_0 s_0^\\top F'(x_0)^\\top\n",
    "         \\end{bmatrix}\n",
    "       }{\n",
    "         s_0^\\top s_0\n",
    "       } -\n",
    "       \\frac{\n",
    "         z_0^\\top s_{02} - s_0^\\top F'(x_0)^\\top s_{02}\n",
    "       }{\n",
    "         (s_0^\\top s_0)^2\n",
    "       } s_0 s_0^\\top\n",
    "\n",
    "Generalizing this update sequence gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_{k + 1}\n",
    "    &= H_k +\n",
    "       \\frac{\n",
    "         (y_k - H_k s_k) s_k^\\top + s_k (y_k - H_k s_k)^\\top\n",
    "       }{\n",
    "         s_k^\\top s_k\n",
    "       } -\n",
    "       \\frac{(y_k - H_k s_k)^\\top s_k s_k s_k^\\top}{(s_k^\\top s_k)^2}\\\\\n",
    "    &= H_k +\n",
    "       \\frac{\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{m \\times n}\\\\\n",
    "           z_k s_k^\\top - F'(x_k) s_k s_k^\\top\n",
    "         \\end{bmatrix} +\n",
    "         \\begin{bmatrix}\n",
    "           \\boldsymbol{0}_{n \\times m} &\n",
    "             s_k z_k^\\top - s_k s_k^\\top F'(x_k)^\\top\n",
    "         \\end{bmatrix}\n",
    "       }{\n",
    "         s_k^\\top s_k\n",
    "       } -\n",
    "       \\frac{\n",
    "         z_k^\\top s_{k2} - s_k^\\top F'(x_k)^\\top s_{k2}\n",
    "       }{\n",
    "         (s_k^\\top s_k)^2\n",
    "       } s_k s_k^\\top.\n",
    "\n",
    "Unlike (a.1), the remaining block matrices cannot be isolated to form a\n",
    "symmetric secant update.  This means even though Theorem 9.1.2 guarantees\n",
    "its convergence to :math:`x_*`, there is no guarantee on the Hessian.\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "In this case, the positive definite secant method exactly computes the linear\n",
    "portion of the Hessian in a single step.  The symmetric secant method does not\n",
    "seem to be directly affected by :math:`\\nabla f(x)`.\n",
    "\n",
    "(c)\n",
    "---\n",
    "\n",
    "It is interesting that the symmetric secant method's Hessian converges to\n",
    ":math:`\\nabla^2 f(x_*)` numerically if the stopping criterion is ignored.\n",
    "\n",
    "When :math:`\\nabla f(x_0)` is not zero in the linear components of\n",
    ":math:`\\nabla f(x)`, the symmetric secant method takes several times longer to\n",
    "converge to the correct Hessian compared to the positive definite secant method.\n",
    "However, it does converge to the correct Hessian."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "import numpy\n",
    "\n",
    "def pdsu(x_c, H_c):\n",
    "    x_k = x_c - numpy.linalg.inv(H_c) * fp(x_c)\n",
    "    s_k = x_k - x_c\n",
    "    y_k = fp(x_k) - fp(x_c)\n",
    "\n",
    "    _ = (y_k * y_k.T) / (y_k.T * s_k)\n",
    "    _ -= (H_c * s_k * s_k.T * H_c) / (s_k.T * H_c * s_k)\n",
    "    return x_k, H_c + _\n",
    "\n",
    "def ssu(x_c, H_c):\n",
    "    x_k = x_c - numpy.linalg.inv(H_c) * fp(x_c)\n",
    "    s_k = x_k - x_c\n",
    "    y_k = fp(x_k) - fp(x_c)\n",
    "\n",
    "    _ = (y_k - H_c * s_k) * s_k.T + s_k * (y_k - H_c * s_k).T\n",
    "    _ /= s_k.T * s_k\n",
    "    dp = (y_k - H_c * s_k).T * s_k\n",
    "    _ -= (dp.flat[0] * s_k * s_k.T) / (s_k.T * s_k)**2\n",
    "    return x_k, H_c + _\n",
    "\n",
    "def fp(x):\n",
    "    x = x.flat\n",
    "    return numpy.asmatrix([[2 * x[0] + 2 * x[1]],\n",
    "                           [2 * x[0] + 4 * x[1] + 4 * x[1]**3]])\n",
    "\n",
    "def fpp(x):\n",
    "    x = x.flat\n",
    "    return numpy.asmatrix([[2, 2],\n",
    "                           [2, 4 + 12 * x[1]**2]])\n",
    "x_0 = numpy.asmatrix([[1],\n",
    "                    [-1]])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "x_c = x_0\n",
    "H_c = fpp(x_c)\n",
    "_ = 'x_{0}: {1}\\t\\tH_{0}: {2}'\n",
    "print(_.format(0, numpy.asarray(x_c).squeeze(),\n",
    "               numpy.asarray(H_c.flatten()).squeeze()))\n",
    "\n",
    "for i in range(8):\n",
    "    x_k, H_k = pdsu(x_c, H_c)\n",
    "    print(_.format(i + 1, numpy.asarray(x_k).squeeze(),\n",
    "                   numpy.asarray(H_k.flatten()).squeeze()))\n",
    "    x_c, H_c = x_k, H_k"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "x_c = x_0\n",
    "H_c = fpp(x_c)\n",
    "_ = 'x_{0}: {1}\\t\\tH_{0}: {2}'\n",
    "print(_.format(0, numpy.asarray(x_c).squeeze(),\n",
    "               numpy.asarray(H_c.flatten()).squeeze()))\n",
    "\n",
    "for i in range(8):\n",
    "    x_k, H_k = ssu(x_c, H_c)\n",
    "    print(_.format(i + 1, numpy.asarray(x_k).squeeze(),\n",
    "                   numpy.asarray(H_k.flatten()).squeeze()))\n",
    "    x_c, H_c = x_k, H_k"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 15\n",
    "===========\n",
    "\n",
    "There is a typo in the definition of :math:`f`.  This exercise illustrates that\n",
    "the convergence of the Hessian using either method depends on the function and\n",
    "is not true in general.\n",
    "\n",
    "From (a) and (b), it is not obvious that both methods converge to the same\n",
    "incorrect Hessian.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_1 &= H_0 + \\frac{y_0 y_0^\\top}{y_0^\\top s_0} -\n",
    "          \\frac{H_0 s_0 s_0^\\top H_0}{s_0^\\top H_0 s_0}\\\\\n",
    "    &= I + \\frac{y_0 y_0^\\top}{y_0^\\top s_0} - \\frac{s_0 s_0^\\top}{s_0^\\top s_0}\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_1 &= H_0 +\n",
    "          \\frac{\n",
    "            (y_0 - H_0 s_0) s_0^\\top + s_0 (y_0 - H_0 s_0)^\\top\n",
    "          }{\n",
    "            s_0^\\top s_0\n",
    "          } -\n",
    "          \\frac{\n",
    "            (y_0 - H_0 s_0)^\\top s_0 s_0 s_0^\\top\n",
    "          }{\n",
    "            (s_0^\\top s_0)^2\n",
    "          }\\\\\n",
    "    &= I + \\frac{(y_0 - s_0) s_0^\\top + s_0 (y_0 - s_0)^\\top}{s_0^\\top s_0} -\n",
    "       \\frac{(y_0 - s_0)^\\top s_0 s_0 s_0^\\top}{(s_0^\\top s_0)^2}\\\\\n",
    "    &= I +\n",
    "       \\frac{\n",
    "         y_0 s_0^\\top - s_0 s_0^\\top + s_0 y_0^\\top - s_0 s_0^\\top\n",
    "       }{\n",
    "         s_0^\\top s_0\n",
    "       } -\n",
    "       \\frac{(y_0^\\top s_0 - s_0^\\top s_0) s_0 s_0^\\top}{(s_0^\\top s_0)^2}\\\\\n",
    "    &= I + \\frac{y_0 s_0^\\top + s_0 y_0^\\top - s_0 s_0^\\top}{s_0^\\top s_0} -\n",
    "       \\frac{y_0^\\top s_0}{(s_0^\\top s_0)^2} s_0 s_0^\\top\\\\\n",
    "    &= I + \\frac{y_0 s_0^\\top + s_0 y_0^\\top}{s_0^\\top s_0} -\n",
    "       (1 + \\frac{y_0^\\top s_0}{s_0^\\top s_0}) \\frac{s_0 s_0^\\top}{s_0^\\top s_0}"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 16, Exercise 17\n",
    "========================\n",
    "\n",
    "These exercises are related to benchmarking different minimization algorithms.\n",
    "These tasks are already completed by existing solver packages such as\n",
    "Ceres and Eigen."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 18\n",
    "===========\n",
    "\n",
    "Let :math:`f(x) = 2^{-1} x^\\top H x` be a positive definite quadratic where the\n",
    "Hessian :math:`H \\in \\mathbb{R}^{n \\times n}` and\n",
    ":math:`x_c, x_+ \\in \\mathbb{R}^n` are distinct points.\n",
    "\n",
    "Define :math:`s` and :math:`y` according to (9.2.11b) such that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\nabla f(x) &= Hx\\\\\\\\\n",
    "   \\nabla^2 f(x) &= H\\\\\\\\\n",
    "   s &= x_+ - x_c\\\\\\\\\n",
    "   y &= \\nabla f(x_+) - \\nabla f(x_c) = H (x_+ - x_c) = Hs.\n",
    "\n",
    "The characteristic equation of :math:`\\frac{s^\\top y}{s^\\top s} I` is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\det\\left( \\frac{s^\\top y}{s^\\top s} I - \\nu I \\right) = 0,\n",
    "\n",
    "which shows that the eigenvalue :math:`\\nu = \\frac{s^\\top y}{s^\\top s}` has a\n",
    "multiplicity of :math:`n`.\n",
    "\n",
    "Rewriting the eigenvalue gives\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\nu = \\frac{s^\\top y}{s^\\top s} = \\frac{s^\\top H s}{s^\\top s} = v^\\top H v\n",
    "\n",
    "where :math:`v = s \\left\\Vert s \\right\\Vert_2^{-1}`.\n",
    "\n",
    "Recall that an eigenvalue of :math:`H` must satisfy the condition\n",
    "\n",
    ".. math::\n",
    "\n",
    "   Hz &= \\lambda z\\\\\n",
    "   z^\\top H z &= \\lambda z^\\top z.\n",
    "\n",
    "Since :math:`H` is positive definite, its eigenvalues must all be positive.\n",
    "Assuming :math:`z` is restricted to a unit vector, (a) shows that the range of\n",
    "eigenvalues of :math:`H` includes :math:`\\nu`.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   z^\\top H z\n",
    "    &= z^\\top Q \\Lambda Q^\\top z\n",
    "       & \\quad & \\text{real symmetric matrix eigendecomposition}\\\\\n",
    "    &= y^\\top \\Lambda y\n",
    "       & \\quad & y = Q^\\top z\\\\\n",
    "    &= \\sum_{i = 1}^n \\lambda_i y_i^2\\\\\n",
    "    &\\leq \\lambda_\\max \\sum_{i = 1}^n y_i^2\\\\\n",
    "    &= \\lambda_\\max y^\\top y\\\\\n",
    "   z^\\top H z &\\leq \\lambda_\\max z^\\top z"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 19\n",
    "===========\n",
    "\n",
    "Even though each heuristic converged successfully to :math:`x_*`, none of them\n",
    "converged to the correct Hessian with a stopping criterion of :math:`10^{-8}`.\n",
    "\n",
    "The Schnabel heuristic converged much quicker than the identity heuristic.\n",
    "Moreover, the identity heuristic experienced overflow when\n",
    ":math:`x_0 = (-1, 3)^\\top`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "def f(x):\n",
    "    x = x.flat\n",
    "    return x[0]**4 + (x[0] + x[1])**2 + (numpy.exp(x[1]) - 1)**2\n",
    "\n",
    "def fp(x):\n",
    "    x = x.flat\n",
    "    _ = 2 * (x[0] + x[1])\n",
    "    return numpy.asmatrix([[4 * x[0] + _],\n",
    "                           [_ + 2 * (numpy.exp(x[1]) - 1) * numpy.exp(x[1])]])\n",
    "\n",
    "def fpp(x):\n",
    "    x = x.flat\n",
    "    return numpy.asmatrix([[6, 2],\n",
    "                           [2, 4 * numpy.exp(2 * x[1]) - 2 * numpy.exp(x[1])]])\n",
    "x_0 = numpy.asmatrix([[-1],\n",
    "                      [3]])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "x_c = x_0\n",
    "H_c = fpp(x_c)\n",
    "_ = 'x_{0}: {1}\\t\\tH_{0}: {2}'\n",
    "print(_.format(0, numpy.asarray(x_c).squeeze(),\n",
    "               numpy.asarray(H_c.flatten()).squeeze()))\n",
    "\n",
    "for i in range(16):\n",
    "    x_k, H_k = pdsu(x_c, H_c)\n",
    "    print(_.format(i + 1, numpy.asarray(x_k).squeeze(),\n",
    "                   numpy.asarray(H_k.flatten()).squeeze()))\n",
    "    x_c, H_c = x_k, H_k"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "x_c = x_0\n",
    "H_c = numpy.eye(len(x_c))\n",
    "_ = 'x_{0}: {1}\\t\\tH_{0}: {2}'\n",
    "print(_.format(0, numpy.asarray(x_c).squeeze(),\n",
    "               numpy.asarray(H_c.flatten()).squeeze()))\n",
    "\n",
    "for i in range(8):\n",
    "    x_k, H_k = pdsu(x_c, H_c)\n",
    "    print(_.format(i + 1, numpy.asarray(x_k).squeeze(),\n",
    "                   numpy.asarray(H_k.flatten()).squeeze()))\n",
    "    x_c, H_c = x_k, H_k"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "x_c = x_0\n",
    "H_c = numpy.eye(len(x_c)) * f(x_0)\n",
    "_ = 'x_{0}: {1}\\t\\tH_{0}: {2}'\n",
    "print(_.format(0, numpy.asarray(x_c).squeeze(),\n",
    "               numpy.asarray(H_c.flatten()).squeeze()))\n",
    "\n",
    "for i in range(16):\n",
    "    x_k, H_k = pdsu(x_c, H_c)\n",
    "    print(_.format(i + 1, numpy.asarray(x_k).squeeze(),\n",
    "                   numpy.asarray(H_k.flatten()).squeeze()))\n",
    "    x_c, H_c = x_k, H_k"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 20\n",
    "===========\n",
    "\n",
    "Suppose :math:`H_c \\triangleq H` is symmetric, :math:`s_c \\triangleq s`, and\n",
    ":math:`y_c \\triangleq y`.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ s\n",
    "    &= \\left(\n",
    "         H + \\frac{(y - Hs) (y - Hs)^\\top}{(y - Hs)^\\top s}\n",
    "       \\right) s\n",
    "       & \\quad & \\text{(9.6.1)}\\\\\n",
    "    &= Hs +\n",
    "       \\frac{\n",
    "         yy^\\top - y s^\\top H^\\top - Hs y^\\top + Hs s^\\top H^\\top\n",
    "       }{\n",
    "         y^\\top s - s^\\top H^\\top s\n",
    "       } s\\\\\n",
    "    &= Hs +\n",
    "       \\frac{\n",
    "         (y^\\top s - s^\\top H^\\top s) y - (y^\\top s - s^\\top H^\\top s) Hs\n",
    "       }{\n",
    "         y^\\top s - s^\\top H^\\top s\n",
    "       }\\\\\n",
    "    &= y\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "As laid out in :ref:`Exercise 3 <dennis1996numerical-ex-9.3>`, define\n",
    ":math:`\\Sigma \\triangleq \\begin{bmatrix} \\sigma_1 & \\sigma_2\\\\\n",
    "\\sigma_3 & \\sigma_4 \\end{bmatrix}`.  :math:`H_+ - H` can be decomposed into\n",
    "\n",
    ".. math::\n",
    "\n",
    "   H_+ - H\n",
    "    &= \\begin{bmatrix} y - Hs & s \\end{bmatrix}\n",
    "       \\begin{bmatrix} \\sigma_1 & \\sigma_2\\\\ \\sigma_3 & \\sigma_4 \\end{bmatrix}\n",
    "       \\begin{bmatrix} \\left( y - Hs \\right)^\\top\\\\ s^\\top \\end{bmatrix}\\\\\n",
    "    &= \\sigma_1 \\left( y - Hs \\right) \\left( y - Hs \\right)^\\top +\n",
    "       \\sigma_3 s \\left( y - Hs \\right)^\\top +\n",
    "       \\sigma_2 \\left( y - Hs \\right) s^\\top + \\sigma_4 s s^\\top\n",
    "\n",
    "where :math:`\\sigma_1 = \\frac{1}{(y - Hs)^\\top s}` and\n",
    ":math:`\\sigma_2 = \\sigma_3 = \\sigma_4 = 0`.\n",
    "\n",
    "By inspection, :math:`H_+ - H = \\left( H_+ - H \\right)^\\top`.  Since\n",
    ":math:`\\det(\\Sigma) = 0`, :math:`\\Sigma` is not a full-rank matrix.  Assuming\n",
    ":math:`\\sigma_1 \\neq 0`, :math:`H_+ - H` has a rank of one."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 21\n",
    "===========\n",
    "\n",
    "Let :math:`H_c \\triangleq H`, :math:`s_c \\triangleq s`, and\n",
    ":math:`y_c \\triangleq y`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   & H_+(\\phi)\\\\\n",
    "    &= H + \\frac{(y - Hs) y^\\top + y (y - Hs)^\\top}{y^\\top s} -\n",
    "       \\frac{(y - Hs)^\\top s y y^\\top}{(y^\\top s)^2} -\n",
    "       \\phi (s^\\top H s)\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]^\\top\\\\\n",
    "    &= H + \\frac{(y - Hs) y^\\top + y (y - Hs)^\\top}{y^\\top s} -\n",
    "       \\frac{(y - Hs)^\\top s y y^\\top}{(y^\\top s)^2} +\n",
    "       \\frac{(s^\\top H s)^2}{s^\\top (y - Hs)}\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]^\\top\\\\\n",
    "    &= H +\n",
    "       \\frac{\n",
    "         y y^\\top y^\\top s - Hs y^\\top y^\\top s - y s^\\top H^\\top y^\\top s +\n",
    "         s^\\top H^\\top s y y^\\top\n",
    "       }{\n",
    "         (y^\\top s)^2\n",
    "       } +\n",
    "       \\frac{(s^\\top H s)^2}{s^\\top (y - Hs)}\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]\n",
    "         \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]^\\top\n",
    "       & \\quad & \\text{(a)}\\\\\n",
    "    &= H +\n",
    "       \\frac{\n",
    "         y y^\\top (y^\\top s)^2 - Hs y^\\top (y^\\top s)^2 -\n",
    "         y s^\\top H^\\top (y^\\top s)^2\n",
    "       }{\n",
    "         (y^\\top s)^2 s^\\top (y - Hs)\n",
    "       } +\n",
    "       \\frac{Hs s^\\top H^\\top}{s^\\top (y - Hs)}\n",
    "       & \\quad & \\text{merge (b) and (c)}\\\\\n",
    "    &= H + \\frac{(y - Hs) (y - Hs)^\\top}{s^\\top (y - Hs)}\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   & \\frac{(y - Hs) y^\\top + y (y - Hs)^\\top}{y^\\top s} -\n",
    "     \\frac{(y - Hs)^\\top s y y^\\top}{(y^\\top s)^2}\\\\\n",
    "    &= \\frac{\n",
    "         y y^\\top y^\\top s - Hs y^\\top y^\\top s + y y^\\top y^\\top s -\n",
    "         y s^\\top H^\\top y^\\top s\n",
    "       }{\n",
    "         (y^\\top s)^2\n",
    "       } -\n",
    "       \\frac{y^\\top s y y^\\top - s^\\top H^\\top s y y^\\top}{(y^\\top s)^2}\\\\\n",
    "    &= \\frac{\n",
    "         y y^\\top y^\\top s - Hs y^\\top y^\\top s - y s^\\top H^\\top y^\\top s +\n",
    "         s^\\top H^\\top s y y^\\top\n",
    "       }{\n",
    "         (y^\\top s)^2\n",
    "       }\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   & \\frac{(s^\\top H s)^2}{s^\\top (y - Hs)}\n",
    "       \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]\n",
    "       \\left[ \\frac{y}{y^\\top s} - \\frac{Hs}{s^\\top H s} \\right]^\\top\\\\\n",
    "    &= \\frac{(s^\\top H s)^2}{s^\\top (y - Hs)}\n",
    "         \\left[\n",
    "           \\frac{y y^\\top}{(y^\\top s)^2} -\n",
    "           \\frac{y s^\\top H^\\top}{y^\\top s s^\\top H s} -\n",
    "           \\frac{Hs y^\\top}{s^\\top H s y^\\top s} +\n",
    "           \\frac{Hs s^\\top H^\\top}{(s^\\top H s)^2}\n",
    "       \\right]\\\\\n",
    "    &= \\frac{(s^\\top H s)^2 y y^\\top}{(y^\\top s)^2 s^\\top (y - Hs)} -\n",
    "       \\frac{s^\\top Hs y s^\\top H^\\top}{y^\\top s s^\\top (y - Hs)} -\n",
    "       \\frac{s^\\top Hs Hs y^\\top}{y^\\top s s^\\top (y - Hs)} +\n",
    "       \\frac{Hs s^\\top H^\\top}{s^\\top (y - Hs)}\\\\\n",
    "    &= \\frac{s^\\top H s y y^\\top s^\\top H s}{(y^\\top s)^2 s^\\top (y - Hs)} -\n",
    "       \\frac{y s^\\top H^\\top y^\\top s s^\\top Hs}{(y^\\top s)^2 s^\\top (y - Hs)} -\n",
    "       \\frac{Hs y^\\top y^\\top s s^\\top Hs}{(y^\\top s)^2 s^\\top (y - Hs)} +\n",
    "       \\frac{Hs s^\\top H^\\top}{s^\\top (y - Hs)}\n",
    "\n",
    "(c)\n",
    "---\n",
    "\n",
    ".. math::\n",
    "\n",
    "   & \\frac{\n",
    "       y y^\\top y^\\top s - Hs y^\\top y^\\top s - y s^\\top H^\\top y^\\top s +\n",
    "       s^\\top H^\\top s y y^\\top\n",
    "     }{\n",
    "       (y^\\top s)^2\n",
    "     }\n",
    "     \\frac{s^\\top (y - Hs)}{s^\\top (y - Hs)}\\\\\n",
    "    &= \\frac{\n",
    "         y y^\\top y^\\top s s^\\top (y - Hs) -\n",
    "         Hs y^\\top y^\\top s s^\\top (y - Hs) -\n",
    "         y s^\\top H^\\top y^\\top s s^\\top (y - Hs) +\n",
    "         s^\\top H^\\top s y y^\\top s^\\top (y - Hs)\n",
    "       }{\n",
    "         (y^\\top s)^2 s^\\top (y - Hs)\n",
    "       }\\\\\n",
    "    &= \\frac{\n",
    "         y y^\\top (y^\\top s)^2 -\n",
    "         Hs y^\\top y^\\top s s^\\top (y - Hs) -\n",
    "         y s^\\top H^\\top y^\\top s s^\\top (y - Hs) -\n",
    "         s^\\top H^\\top s y y^\\top s^\\top Hs\n",
    "       }{\n",
    "         (y^\\top s)^2 s^\\top (y - Hs)\n",
    "       }"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Exercise 22\n",
    "===========\n",
    "\n",
    "Substitute in relations such as (9.6.1)."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. rubric:: References\n",
    "\n",
    ".. bibliography:: chapter-09.bib"
   ]
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "celltoolbar": "Raw Cell Format",
  "kernelspec": {
   "display_name": "Python [default]",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.5.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}

{
 "cells": [
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "*********************************************\n",
    "Projective Geometry and Transformations of 2D\n",
    "*********************************************"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. _hartley2004-ex-2.i:\n",
    "\n",
    "(i) Affine Transformations\n",
    "==========================\n",
    "\n",
    "Recall from (2.10) an affinity is defined as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}' = \\mathbf{H}_A \\mathbf{x} =\n",
    "   \\begin{bmatrix}\n",
    "     \\mathbf{A} & \\mathbf{t}\\\\\n",
    "     \\boldsymbol{0}^\\top & 1\n",
    "   \\end{bmatrix} \\mathbf{x} =\n",
    "   \\begin{bmatrix}\n",
    "     a_{11} & a_{12} & t_x\\\\\n",
    "     a_{21} & a_{22} & t_y\\\\\n",
    "     0 & 0 & 1\n",
    "   \\end{bmatrix} \\begin{bmatrix} x\\\\ y\\\\ z \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     a_{11} x + a_{12} y + t_x z\\\\\n",
    "     a_{21} x + a_{22} y + t_y z\\\\\n",
    "     z\n",
    "   \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     x'\\\\\n",
    "     y'\\\\\n",
    "     z'\n",
    "   \\end{bmatrix}.\n",
    "\n",
    "Observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_A^{-1} =\n",
    "   \\left(\n",
    "     \\begin{bmatrix}\n",
    "       1 & 0 & t_x\\\\\n",
    "       0 & 1 & t_y\\\\\n",
    "       0 & 0 & 1\n",
    "     \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       a_{11} & a_{12} & 0\\\\\n",
    "       a_{21} & a_{22} & 0\\\\\n",
    "       0 & 0 & 1\n",
    "     \\end{bmatrix}\n",
    "   \\right)^{-1} =\n",
    "   \\frac{1}{a_{11} a_{22} - a_{12} a_{21}}\n",
    "   \\begin{bmatrix}\n",
    "     a_{22} & -a_{12} & 0\\\\\n",
    "     -a_{21} & a_{11} & 0\\\\\n",
    "     0 & 0 & a_{11} a_{22} - a_{12} a_{21}\n",
    "   \\end{bmatrix}\n",
    "   \\begin{bmatrix}\n",
    "     1 & 0 & -t_x\\\\\n",
    "     0 & 1 & -t_y\\\\\n",
    "     0 & 0 & 1\n",
    "   \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     \\mathbf{A}' & \\mathbf{t}'\\\\\n",
    "     \\boldsymbol{0} & 1\n",
    "   \\end{bmatrix}.\n",
    "\n",
    "An affinity is degenerate when :math:`a_{11} a_{22} = a_{12} a_{21}` i.e.\n",
    "its columns are linearly dependent.\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    "By inspection, a degenerate affinity collapses all the points on a conic\n",
    "section into a single line or point.  The rest of the analysis will focus on\n",
    "non-degenerate affinities.\n",
    "\n",
    "The equation of a conic (2.3) in homogeneous coordinates is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}^\\top \\mathbf{C} \\mathbf{x} =\n",
    "   \\mathbf{x}^\\top\n",
    "     \\begin{bmatrix}\n",
    "       a & b / 2 & d / 2\\\\\n",
    "       b / 2 & c & e / 2\\\\\n",
    "       d / 2 & e / 2 & f\n",
    "     \\end{bmatrix} \\mathbf{x}.\n",
    "\n",
    "The type of conic section can be determined by computing the minor\n",
    ":math:`\\det \\mathbf{C}_{33}`:\n",
    "\n",
    "- :math:`\\mathbf{C}` is a hyperbola if and only if\n",
    "  :math:`\\det \\mathbf{C}_{33} < 0`,\n",
    "- :math:`\\mathbf{C}` is a parabola if and only if\n",
    "  :math:`\\det \\mathbf{C}_{33} = 0`, and\n",
    "- :math:`\\mathbf{C}` is an ellipse if and only if\n",
    "  :math:`\\det \\mathbf{C}_{33} > 0`.\n",
    "\n",
    "  - When :math:`a = c` and :math:`b = 0`, the equation represents a circle.\n",
    "\n",
    "To simplify notations, rewrite the conic coefficient matrix as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{C} =\n",
    "   \\begin{bmatrix}\n",
    "     \\boldsymbol{\\alpha} & \\boldsymbol{\\beta}\\\\\n",
    "     \\boldsymbol{\\beta}^\\top & \\gamma\n",
    "   \\end{bmatrix}\n",
    "\n",
    "where :math:`\\boldsymbol{\\alpha} = \\begin{bmatrix} a & b / 2\\\\ b / 2 & c \\end{bmatrix}`,\n",
    ":math:`\\boldsymbol{\\beta} = \\begin{bmatrix} d / 2\\\\ e / 2 \\end{bmatrix}`, and\n",
    ":math:`\\gamma = f`.  Under an affinity, a conic transforms to\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}^\\top \\mathbf{C}_c \\mathbf{x} =\n",
    "   {\\mathbf{x}'}^\\top \\mathbf{H}_A^{-\\top}\n",
    "     \\mathbf{C}_c \\mathbf{H}_A^{-1} \\mathbf{x}' =\n",
    "   {\\mathbf{x}'}^\\top\n",
    "     \\begin{bmatrix}\n",
    "       {\\mathbf{A}'}^\\top \\boldsymbol{\\alpha} \\mathbf{A}' &\n",
    "         {\\mathbf{A}'}^\\top \\boldsymbol{\\alpha} \\mathbf{t}' +\n",
    "             {\\mathbf{A}'}^\\top \\boldsymbol{\\beta}\\\\\n",
    "       {\\mathbf{t}'}^\\top \\boldsymbol{\\alpha} \\mathbf{A}' +\n",
    "           \\boldsymbol{\\beta}^\\top \\mathbf{A}' &\n",
    "         {\\mathbf{t}'}^\\top \\boldsymbol{\\alpha} \\mathbf{t}' +\n",
    "             2 {\\mathbf{t}'}^\\top \\boldsymbol{\\beta} + \\gamma\n",
    "     \\end{bmatrix} \\mathbf{x}' =\n",
    "   {\\mathbf{x}'}^\\top \\mathbf{C}' \\mathbf{x}'.\n",
    "\n",
    "Assuming :math:`\\det \\mathbf{C} > 0`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\det \\mathbf{C}'_{33}\n",
    "    &= \\det\n",
    "         \\begin{bmatrix}\n",
    "           a'_{11} \\left( a a'_{11} + \\frac{b}{2} a'_{21} \\right) +\n",
    "               a'_{21} \\left( \\frac{b}{2} a'_{11} + c a'_{21} \\right) &\n",
    "             a'_{11} \\left( a a'_{12} + \\frac{b}{2} a'_{22} \\right) +\n",
    "                 a'_{21} \\left( \\frac{b}{2} a'_{12} + c a'_{22} \\right)\\\\\n",
    "           a'_{12} \\left( a a'_{11} + \\frac{b}{2} a'_{21} \\right) +\n",
    "                 a'_{22} \\left( \\frac{b}{2} a'_{11} + c a'_{21} \\right) &\n",
    "             a'_{12} \\left( a a'_{12} + \\frac{b}{2} a'_{22} \\right) +\n",
    "                 a'_{22} \\left( \\frac{b}{2} a'_{12} + c a'_{22} \\right)\\\\\n",
    "         \\end{bmatrix}\\\\\n",
    "    &= \\det({\\mathbf{A}'}^\\top \\boldsymbol{\\alpha} \\mathbf{A}')\\\\\n",
    "    &= \\det({\\mathbf{A}'}^\\top) \\det(\\boldsymbol{\\alpha}) \\det(\\mathbf{A}')\\\\\n",
    "    &= \\det(\\mathbf{A}')^2 \\det(\\boldsymbol{\\alpha})\\\\\n",
    "    &= \\det(\\mathbf{A}')^2 \\left( ac - \\frac{b^2}{4} \\right)\\\\\n",
    "    &> 0.\n",
    "\n",
    "Thus, an affinity can map a circle to an ellipse, but it cannot map\n",
    "an ellipse to a parabola or hyperbola.\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "Any pair of points on a line :math:`\\mathbf{l}` can be represented as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}_2 - \\mathbf{x}_1 = \\lambda \\mathbf{d}\n",
    "\n",
    "where the scalar :math:`\\lambda \\in \\mathbb{R}` and the direction\n",
    ":math:`\\mathbf{d} \\in \\mathbb{R}^3`.  Note that the direction vector satisfies\n",
    ":math:`\\mathbf{d}^\\top \\mathbf{l} = 0` and\n",
    ":math:`\\left\\Vert \\mathbf{d} \\right\\Vert_2 = 1`.  Evidently, any line\n",
    ":math:`\\mathbf{l}'` parallel to :math:`\\mathbf{l}` must have the same direction\n",
    "vector.  Let :math:`\\mathbf{x}'_2 - \\mathbf{x}'_1 = \\lambda' \\mathbf{d}` denote\n",
    "the corresponding line segment on :math:`\\mathbf{l}'`.\n",
    "\n",
    "The ratio of these parallel line segments is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\n",
    "     \\left\\Vert \\mathbf{x}_2 - \\mathbf{x}_1 \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert \\mathbf{x}'_2 - \\mathbf{x}'_1 \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\lambda \\left\\Vert \\mathbf{d} \\right\\Vert_2\n",
    "   }{\n",
    "     \\lambda' \\left\\Vert \\mathbf{d} \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\\lambda}{\\lambda'}.\n",
    "\n",
    "The ratio of these line segments under an affinity is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\n",
    "     \\left\\Vert \\mathbf{H}_A (\\mathbf{x}_2 - \\mathbf{x}_1) \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert \\mathbf{H}_A (\\mathbf{x}'_2 - \\mathbf{x}'_1) \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\lambda \\left\\Vert \\mathbf{H}_A \\mathbf{d} \\right\\Vert_2\n",
    "   }{\n",
    "     \\lambda' \\left\\Vert \\mathbf{H}_A \\mathbf{d} \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\\lambda}{\\lambda'}.\n",
    "\n",
    "Therefore, the ratio of lengths on parallel line segments is invariant to\n",
    "affinities.  Clearly, when the line segments are not parallel, the direction\n",
    "vectors are no longer equal.  Hence the ratio is no longer invariant to\n",
    "affinities.  Note that projectivities map lines to lines, but do not necessarily\n",
    "preserve parallelism."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(ii) Projective Transformations\n",
    "===============================\n",
    "\n",
    "Let :math:`\\mathbf{x}` denote a point on a unit circle at the origin\n",
    "(example 2.28) such that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   0 = \\mathbf{x}^\\top \\mathbf{C} \\mathbf{x} =\n",
    "   \\mathbf{x}^\\top\n",
    "     \\begin{bmatrix}\n",
    "       1 & 0 & 0\\\\\n",
    "       0 & 1 & 0\\\\\n",
    "       0 & 0 & -1\n",
    "     \\end{bmatrix} \\mathbf{x} =\n",
    "   \\mathbf{x}^\\top\n",
    "     \\begin{bmatrix}\n",
    "       \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & -1\n",
    "     \\end{bmatrix} \\mathbf{x} =\n",
    "   \\mathbf{x}^\\top \\mathbf{S}_3 \\mathbf{x}.\n",
    "\n",
    "From result 2.13, a projectivity (2.13) that fixes as a set a unit circle at the\n",
    "origin must satisfy (result 2.13)\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{C}' =\n",
    "   \\mathbf{H}^{-\\top} \\mathbf{C} \\mathbf{H}^{-1} =\n",
    "   \\mathbf{H}^{-\\top} \\mathbf{S}_3 \\mathbf{H}^{-1} =\n",
    "   \\mathbf{S}_3\n",
    "\n",
    "where according to (2.17)\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}^{-1} =\n",
    "   \\mathbf{H}_P^{-1} \\mathbf{H}_A^{-1} \\mathbf{H}_S^{-1} =\n",
    "   \\begin{bmatrix}\n",
    "     \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "     \\mathbf{v}^\\top & 1\n",
    "   \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       K & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & 1\n",
    "     \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       s \\mathbf{R} & \\mathbf{t}\\\\\n",
    "       \\boldsymbol{0}^\\top & 1\n",
    "     \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     s K \\mathbf{R} & K \\mathbf{t}\\\\\n",
    "     s \\mathbf{v}^\\top K \\mathbf{R} & \\mathbf{v}^\\top K \\mathbf{t} + 1\n",
    "   \\end{bmatrix}.\n",
    "\n",
    "These properties imply\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_P^{-\\top} \\mathbf{S}_3 \\mathbf{H}_P^{-1} =\n",
    "   \\begin{bmatrix}\n",
    "     \\mathbf{I} & \\mathbf{v}\\\\\n",
    "     \\boldsymbol{0}^\\top & 1\n",
    "   \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & -1\n",
    "     \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "       \\mathbf{v}^\\top & 1\n",
    "     \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     \\mathbf{I} - \\mathbf{v} \\mathbf{v}^\\top & -\\mathbf{v}\\\\\n",
    "     -\\mathbf{v}^\\top & -1\n",
    "   \\end{bmatrix} =\n",
    "   \\mathbf{S}_3\n",
    "   \\quad \\Rightarrow \\quad\n",
    "   \\mathbf{v} = \\boldsymbol{0},\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_A^{-\\top} \\mathbf{S}_3 \\mathbf{H}_A^{-1} =\n",
    "   \\begin{bmatrix}\n",
    "     K^\\top & \\boldsymbol{0}\\\\\n",
    "     \\boldsymbol{0}^\\top & 1\n",
    "   \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & -1\n",
    "     \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       K & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & 1\n",
    "     \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     K^\\top K & \\boldsymbol{0}\\\\\n",
    "     \\boldsymbol{0}^\\top & -1\n",
    "   \\end{bmatrix} =\n",
    "   \\mathbf{S}_3\n",
    "   \\quad \\Rightarrow \\quad\n",
    "   K^\\top K = \\mathbf{I},\n",
    "\n",
    "and\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_S^{-\\top} \\mathbf{S}_3 \\mathbf{H}_S^{-1} =\n",
    "   \\begin{bmatrix}\n",
    "     s \\mathbf{R}^\\top & \\boldsymbol{0}\\\\\n",
    "     \\mathbf{t}^\\top & 1\n",
    "   \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       \\mathbf{I} & \\boldsymbol{0}\\\\\n",
    "       \\boldsymbol{0}^\\top & -1\n",
    "     \\end{bmatrix}\n",
    "     \\begin{bmatrix}\n",
    "       s \\mathbf{R} & \\mathbf{t}\\\\\n",
    "       \\boldsymbol{0}^\\top & 1\n",
    "     \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     s \\mathbf{R}^\\top \\mathbf{R} & s \\mathbf{R}^\\top \\mathbf{t}\\\\\n",
    "     s \\mathbf{t}^\\top \\mathbf{R} & \\mathbf{t}^\\top \\mathbf{t} - 1\n",
    "   \\end{bmatrix} =\n",
    "   \\mathbf{S}_3\n",
    "   \\quad \\Rightarrow \\quad\n",
    "   s^2 \\mathbf{R}^\\top \\mathbf{R} = \\mathbf{I} \\quad \\land \\quad\n",
    "   \\mathbf{t}^\\top = \\boldsymbol{0}.\n",
    "\n",
    "Hence,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}^{-1} =\n",
    "   \\begin{bmatrix}\n",
    "     s K \\mathbf{R} & \\boldsymbol{0}\\\\\n",
    "     \\boldsymbol{0}^\\top & 1\n",
    "   \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     k_1 s \\cos \\theta & k_1 (-s) \\sin \\theta & 0\\\\\n",
    "     k_2 s \\sin \\theta & k_2 s \\cos \\theta & 0\\\\\n",
    "     0 & 0 & 1\n",
    "   \\end{bmatrix} =\n",
    "   \\begin{bmatrix}\n",
    "     \\alpha & 0 & 0\\\\\n",
    "     0 & \\beta & 0\\\\\n",
    "     0 & 0 & 1\n",
    "   \\end{bmatrix}\n",
    "   \\begin{bmatrix}\n",
    "     \\cos \\theta & -\\sin \\theta & 0\\\\\n",
    "     \\sin \\theta & \\cos \\theta & 0\\\\\n",
    "     0 & 0 & 1\n",
    "   \\end{bmatrix}\n",
    "\n",
    "where :math:`\\alpha = k_1 s = \\pm 1`, :math:`\\beta = k_2 s = \\pm 1`, and\n",
    ":math:`\\theta \\in \\mathbb{R}` represent a three-parameter family of projective\n",
    "transformations.  The factorized form of this family illustrates that the\n",
    "projectivities are restricted to combinations of rotations and reflections."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(iii) Isotropies\n",
    "================\n",
    "\n",
    ":cite:`abdof` has an intuitive way to remember the degrees of points, lines, and\n",
    "planes.\n",
    "\n",
    "A line in 3D space can be specified by two 3D points.  However, once the line is\n",
    "constrained by the points, the points can still move along the line.  Thus, one\n",
    "degree of freedom is retained per point.  Since a point in 3D has three degrees\n",
    "of freedom, the total number of degrees of freedom used to nail down the line\n",
    "is :math:`2 \\times 3 - 2 \\times 1 = 4`.\n",
    "\n",
    "A plane is fully constrained by three 3D points, but the points are free to roam\n",
    "the plane; this motion has two degrees of freedom.  Hence a plane has\n",
    ":math:`3 \\times 3 - 3 \\times 2 = 3` degrees of freedom.\n",
    "\n",
    "A line can also be specified as the intersection of two planes.  Once the line\n",
    "has been found, the planes can freely rotate about the line; this rotation has\n",
    "one degree of freedom.  Therefore, a line has\n",
    ":math:`2 \\times 3 - 2 \\times 1 = 4` degrees of freedom.\n",
    "\n",
    "Two Lines Have an Invariant Under a Similarity\n",
    "----------------------------------------------\n",
    "\n",
    "Define a line segment on :math:`\\mathbf{l}_i` as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{y}_i - \\mathbf{x}_i = t_i \\mathbf{d}_i\n",
    "\n",
    "where the scalar :math:`t_i \\in \\mathbb{R}`, the direction\n",
    ":math:`\\mathbf{d}_i \\in \\mathbb{R}^3`,\n",
    ":math:`\\mathbf{d}_i^\\top \\mathbf{l}_i = 0`, and\n",
    ":math:`\\left\\Vert \\mathbf{d}_i \\right\\Vert_2 = 1` for :math:`i = 1, 2`.\n",
    "\n",
    "The angle between these line segments is given by their dot product\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\cos \\theta =\n",
    "   \\frac{\n",
    "     (\\mathbf{y}_1 - \\mathbf{x}_1)^\\top (\\mathbf{y}_2 - \\mathbf{x}_2)\n",
    "   }{\n",
    "     \\left\\Vert \\mathbf{y}_1 - \\mathbf{x}_1 \\right\\Vert_2\n",
    "     \\left\\Vert \\mathbf{y}_2 - \\mathbf{x}_2 \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     t_1 t_2 \\mathbf{d}_1^\\top \\mathbf{d}_2\n",
    "   }{\n",
    "     t_1 \\left\\Vert \\mathbf{d}_1 \\right\\Vert_2\n",
    "     t_2 \\left\\Vert \\mathbf{d}_2 \\right\\Vert_2\n",
    "   } =\n",
    "   \\mathbf{d}_1^\\top \\mathbf{d}_2.\n",
    "\n",
    "Let :math:`\\mathbf{H}_S` denote a similarity (2.9) where\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}' = \\mathbf{H}_S \\mathbf{x} =\n",
    "   \\begin{bmatrix}\n",
    "     s \\mathbf{R} & \\mathbf{t}\\\\\n",
    "     \\boldsymbol{0}^\\top & 1\n",
    "   \\end{bmatrix} \\mathbf{x}.\n",
    "\n",
    "Recall that the last coordinate of :math:`\\mathbf{d}_i` is zero and\n",
    ":math:`\\mathbf{R}^\\top \\mathbf{R} = \\mathbf{I}`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\cos \\theta =\n",
    "   \\frac{\n",
    "     (t_1 \\mathbf{H}_S \\mathbf{d}_1)^\\top (t_2 \\mathbf{H}_S \\mathbf{d}_2)\n",
    "   }{\n",
    "     \\left\\Vert t_1 \\mathbf{H}_S \\mathbf{d}_1 \\right\\Vert_2\n",
    "     \\left\\Vert t_2 \\mathbf{H}_S \\mathbf{d}_2 \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     t_1 t_2\n",
    "     \\left(\n",
    "       s \\mathbf{R} \\mathbf{d}_{1_{1 \\colon 2}}\n",
    "     \\right)^\\top\n",
    "     \\left(\n",
    "       s \\mathbf{R} \\mathbf{d}_{2_{1 \\colon 2}}\n",
    "     \\right)\n",
    "   }{\n",
    "     t_1 \\left\\Vert s \\mathbf{R} \\mathbf{d}_{1_{1 \\colon 2}} \\right\\Vert_2\n",
    "     t_2 \\left\\Vert s \\mathbf{R} \\mathbf{d}_{2_{1 \\colon 2}} \\right\\Vert_2\n",
    "   } =\n",
    "   \\mathbf{d}_1^\\top \\mathbf{d}_2.\n",
    "\n",
    "Therefore, the angle between two lines is invariant under a similarity.  Hence\n",
    "the number of invariants is undoubtedly at least one, which violates the\n",
    "equality case of the counting argument in result 2.16 because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{DoF}(\\mathbf{l}_1) +\n",
    "       \\text{DoF}(\\mathbf{l}_2) - \\text{DoF}(\\mathbf{H}_S) =\n",
    "   2 + 2 - 4 = 0.\n",
    "\n",
    "The following will show that the similarity can only be partially determined.\n",
    "\n",
    "Under this point transformation, lines transform according to (2.6)\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{l}' = \\mathbf{H}_S^{-\\top} \\mathbf{l}\n",
    "   \\quad \\Leftrightarrow \\quad\n",
    "   \\mathbf{l} = \\mathbf{H}_S^\\top \\mathbf{l}'.\n",
    "\n",
    "Given the corresponding lines :math:`\\mathbf{l}'_1` and :math:`\\mathbf{l}'_2`,\n",
    "observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\begin{aligned}\n",
    "     \\lambda_i \\begin{bmatrix} a_i\\\\ b_i\\\\ c_i \\end{bmatrix}\n",
    "      &= \\lambda'_i\n",
    "         \\begin{bmatrix}\n",
    "           s r_1 & s r_2 & 0\\\\\n",
    "           -s r_2 & s r_1 & 0\\\\\n",
    "           t_x & t_y & 1\\\\\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix} a'_i\\\\ b'_i\\\\ c'_i \\end{bmatrix}\n",
    "   \\end{aligned}\n",
    "   \\quad \\Leftrightarrow \\quad\n",
    "   \\begin{aligned}\n",
    "     \\lambda_i a_i &= s \\lambda'_i \\left( r_1 a'_i + r_2 b'_i \\right)\\\\\n",
    "     \\lambda_i b_i &= s \\lambda'_i \\left( -r_2 a'_i + r_1 b'_i \\right)\\\\\n",
    "     \\lambda_i c_i &= \\lambda'_i \\left( t_x a'_i + t_y b'_i + c'_i \\right)\n",
    "   \\end{aligned}\n",
    "   \\quad \\Leftrightarrow \\quad\n",
    "   \\begin{aligned}\n",
    "     \\begin{bmatrix} a_1 c'_1\\\\ b_1 c'_1\\\\ a_2 c'_2\\\\ b_2 c'_2 \\end{bmatrix}\n",
    "      &= \\begin{bmatrix}\n",
    "           a'_1 c_1 & b'_1 c_1 & -a_1 a'_1 & -a_1 b'_1\\\\\n",
    "           b'_1 c_1 & -a'_1 c_1 & -b_1 a'_1 & -b_1 b'_1\\\\\n",
    "           a'_2 c_2 & b'_2 c_2 & -a_2 a'_2 & -a_2 b'_2\\\\\n",
    "           b'_2 c_2 & -a'_2 c_2 & -b_2 a'_2 & -b_2 b'_2\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix} s r_1\\\\ s r_2\\\\ t_x\\\\ t_y \\end{bmatrix}\n",
    "   \\end{aligned}\n",
    "\n",
    "where :math:`r_1 = \\cos \\theta` and :math:`r_2 = \\sin \\theta`.\n",
    "\n",
    "Observe that the :math:`4 \\times 4` matrix is rank deficient: its rank is\n",
    "only 3.  If there is one more line correspondence, the full rank matrix\n",
    "would allow the translation :math:`\\mathbf{t}` to be determined exactly, but\n",
    "the rotation and scalar :math:`s` can only be recovered up to a sign via\n",
    ":math:`(s r_1)^2 + (s r_2)^2 = s^2`.\n",
    "\n",
    "Two Lines and Two Points Have an Invariant Under a Projectivity\n",
    "---------------------------------------------------------------\n",
    "\n",
    "Let :math:`\\mathbf{l}_1, \\mathbf{l}_2, \\mathbf{x}_1, \\mathbf{x}_2` denote the\n",
    "pair of lines and points.  The line through the two given points is\n",
    ":math:`\\mathbf{l}_0 = \\mathbf{x}_1 \\times \\mathbf{x}_2` (result 2.4).  This line\n",
    "will intersect the two given lines at\n",
    ":math:`\\mathbf{x}_3 = \\mathbf{l}_0 \\times \\mathbf{l}_1` and\n",
    ":math:`\\mathbf{x}_4 = \\mathbf{l}_0 \\times \\mathbf{l}_2` (result 2.2).  To\n",
    "simplify the proof, arbitrarily define all points on :math:`\\mathbf{l}_0` in\n",
    "terms of :math:`\\mathbf{x}_1` such that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}_i = \\mathbf{x}_1 + t_i \\mathbf{d} \\quad i = 1, 2, 3, 4\n",
    "\n",
    "where :math:`t_i \\in \\mathbb{R}` and :math:`\\mathbf{d}^\\top \\mathbf{l}_0 = 0`\n",
    "e.g. :math:`\\mathbf{d} = \\frac{\\mathbf{x}_4 - \\mathbf{x}_1}{\\left\\Vert \\mathbf{x}_4 - \\mathbf{x}_1 \\right\\Vert_2}`.\n",
    "\n",
    "The cross ratio (2.18) of these points is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{Cross}(\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4) =\n",
    "   \\frac{\n",
    "     \\left\\Vert \\mathbf{x}_1 - \\mathbf{x}_2 \\right\\Vert_2\n",
    "     \\left\\Vert \\mathbf{x}_3 - \\mathbf{x}_4 \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert \\mathbf{x}_1 - \\mathbf{x}_3 \\right\\Vert_2\n",
    "     \\left\\Vert \\mathbf{x}_2 - \\mathbf{x}_4 \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left\\Vert -t_2 \\mathbf{d} \\right\\Vert_2\n",
    "     \\left\\Vert (t_3 - t_4) \\mathbf{d} \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert -t_3 \\mathbf{d} \\right\\Vert_2\n",
    "     \\left\\Vert (t_2 - t_4) \\mathbf{d} \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     t_2 (t_3 - t_4)\n",
    "   }{\n",
    "     t_3 (t_2 - t_4)\n",
    "   }.\n",
    "\n",
    "The cross ratio of these points under a projectivity (2.13) is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{Cross}(\\mathbf{x}'_1, \\mathbf{x}'_2, \\mathbf{x}'_3, \\mathbf{x}'_4) =\n",
    "   \\frac{\n",
    "     \\left\\Vert \\mathbf{H}_P (\\mathbf{x}_1 - \\mathbf{x}_2) \\right\\Vert_2\n",
    "     \\left\\Vert \\mathbf{H}_P (\\mathbf{x}_3 - \\mathbf{x}_4) \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert \\mathbf{H}_P (\\mathbf{x}_1 - \\mathbf{x}_3) \\right\\Vert_2\n",
    "     \\left\\Vert \\mathbf{H}_P (\\mathbf{x}_2 - \\mathbf{x}_4) \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left\\Vert -t_2 \\mathbf{H}_P \\mathbf{d} \\right\\Vert_2\n",
    "     \\left\\Vert (t_3 - t_4) \\mathbf{H}_P \\mathbf{d} \\right\\Vert_2\n",
    "   }{\n",
    "     \\left\\Vert -t_3 \\mathbf{H}_P \\mathbf{d} \\right\\Vert_2\n",
    "     \\left\\Vert (t_2 - t_4) \\mathbf{H}_P \\mathbf{d} \\right\\Vert_2\n",
    "   } =\n",
    "   \\frac{\n",
    "     t_2 (t_3 - t_4)\n",
    "   }{\n",
    "     t_3 (t_2 - t_4)\n",
    "   }.\n",
    "\n",
    "Thus, the cross ratio of the intersection points defined by a pair of lines and\n",
    "points is invariant under a projectivity.  Therefore, the number of invariants\n",
    "is undoubtedly at least one, which violates the equality case of the counting\n",
    "argument in result 2.16 because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{DoF}(\\mathbf{l}_1) + \\text{DoF}(\\mathbf{l}_2) +\n",
    "       \\text{DoF}(\\mathbf{x}_1) + \\text{DoF}(\\mathbf{x}_2) -\n",
    "       \\text{DoF}(\\mathbf{H}_S) =\n",
    "   2 + 2 + 2 + 2 - 8 = 0.\n",
    "\n",
    "The following will show that the projectivity :math:`\\mathbf{H}` (2.5) can only\n",
    "be partially determined.\n",
    "\n",
    "Given the corresponding lines and points\n",
    ":math:`\\mathbf{l}'_1, \\mathbf{l}'_2, \\mathbf{x}'_1, \\mathbf{x}'_2`, observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\begin{aligned}\n",
    "     \\tilde{\\lambda}'_i \n",
    "      &= \\tilde{\\lambda}_i \\begin{bmatrix} x'_i\\\\ y'_i\\\\ z'_i \\end{bmatrix}\n",
    "         \\begin{bmatrix}\n",
    "           h_1 & h_2 & h_3\\\\\n",
    "           h_4 & h_5 & h_6\\\\\n",
    "           h_7 & h_8 & h_9\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix} x_i\\\\ y_i\\\\ z_i \\end{bmatrix}\n",
    "   \\end{aligned}\n",
    "   \\quad \\Leftrightarrow \\quad\n",
    "   \\begin{aligned}\n",
    "     \\tilde{\\lambda}'_i x'_i &= \\tilde{\\lambda}_i \\left( h_1 x_i + h_2 y_i + h_3 z_i \\right)\\\\\n",
    "     \\tilde{\\lambda}'_i y'_i &= \\tilde{\\lambda}_i \\left( h_4 x_i + h_5 y_i + h_6 z_i \\right)\\\\\n",
    "     \\tilde{\\lambda}'_i z'_i &= \\tilde{\\lambda}_i \\left( h_7 x_i + h_8 y_i + h_9 z_i \\right)\n",
    "   \\end{aligned}\n",
    "\n",
    "and\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\begin{aligned}\n",
    "     \\lambda_i \\begin{bmatrix} a_i\\\\ b_i\\\\ c_i \\end{bmatrix}\n",
    "      &= \\lambda'_i\n",
    "         \\begin{bmatrix}\n",
    "           h_1 & h_4 & h_7\\\\\n",
    "           h_2 & h_5 & h_8\\\\\n",
    "           h_3 & h_6 & h_9\n",
    "         \\end{bmatrix}\n",
    "         \\begin{bmatrix} a'_i\\\\ b'_i\\\\ c'_i \\end{bmatrix}\n",
    "   \\end{aligned}\n",
    "   \\quad \\Leftrightarrow \\quad\n",
    "   \\begin{aligned}\n",
    "     \\lambda_i a_i &= \\lambda'_i \\left( h_1 a'_i + h_4 b'_i + h_7 c'_i \\right)\\\\\n",
    "     \\lambda_i b_i &= \\lambda'_i \\left( h_2 a'_i + h_5 b'_i + h_8 c'_i \\right)\\\\\n",
    "     \\lambda_i c_i &= \\lambda'_i \\left( h_3 a'_i + h_6 b'_i + h_9 c'_i \\right)\n",
    "   \\end{aligned}\n",
    "\n",
    "where :math:`\\left\\Vert \\mathbf{H} \\right\\Vert_F = 1`.  An equivalent\n",
    "representation is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\begin{bmatrix}\n",
    "     z'_1 x_1 & z'_1 y_1 & z'_1 z_1 & 0 & 0 & 0 & -x'_1 x_1 & -x'_1 y_1 & -x'_1 z_1\\\\\n",
    "     0 & 0 & 0 & z'_1 x_1 & z'_1 y_1 & z'_1 z_1 & -y'_1 x_1 & -y'_1 y_1 & -y'_1 z_1\\\\\n",
    "     z'_2 x_2 & z'_2 y_2 & z'_2 z_2 & 0 & 0 & 0 & -x'_2 x_2 & -x'_2 y_2 & -x'_2 z_2\\\\\n",
    "     0 & 0 & 0 & z'_2 x_2 & z'_2 y_2 & z'_2 z_2 & -y'_2 x_2 & -y'_2 y_2 & -y'_2 z_2\\\\\n",
    "     c_1 a'_1 & 0 & -a_1 a'_1 & c_1 b'_1 & 0 & -a_1 b'_1 & c_1 c'_1 & 0 & -a_1 c'_1\\\\\n",
    "     0 & c_1 a'_1 & -b_1 a'_1 & 0 & c_1 b'_1 & -b_1 b'_1 & 0 & c_1 c'_1 & -b_1 c'_1\\\\\n",
    "     c_2 a'_2 & 0 & -a_2 a'_2 & c_2 b'_2 & 0 & -a_2 b'_2 & c_2 c'_2 & 0 & -a_2 c'_2\\\\\n",
    "     0 & c_2 a'_2 & -b_2 a'_2 & 0 & c_2 b'_2 & -b_2 b'_2 & 0 & c_2 c'_2 & -b_2 c'_2\n",
    "   \\end{bmatrix}\n",
    "   \\begin{bmatrix}\n",
    "     h_1\\\\ h_2\\\\ h_3\\\\ h_4\\\\ h_5\\\\ h_6\\\\ h_7\\\\ h_8\\\\ h_9\n",
    "   \\end{bmatrix} = \\boldsymbol{0}.\n",
    "\n",
    "Observe that the :math:`8 \\times 9` matrix only has a rank 7 plus the explicit\n",
    "Frobenius norm constraint.  If there is one more line or point correspondence,\n",
    "the matrix would have a rank 8 plus the norm constraint."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(iv) Invariants\n",
    "===============\n",
    "\n",
    "(a)\n",
    "---\n",
    "\n",
    "Recall that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{x}'_i = \\mathbf{H} \\mathbf{x}_i\n",
    "   \\quad \\text{(2.5)}\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{l}'_i = \\mathbf{H}^{-\\top} \\mathbf{l}_i\n",
    "   \\quad \\text{(2.6)}\n",
    "\n",
    "for :math:`i = 1, 2` and any non-singular projectivity :math:`\\mathbf{H}`.\n",
    "\n",
    "Observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\n",
    "     \\left( {\\mathbf{l}'}_1^\\top \\mathbf{x}'_1 \\right)\n",
    "     \\left( {\\mathbf{l}'}_2^\\top \\mathbf{x}'_2 \\right)\n",
    "   }{\n",
    "     \\left( {\\mathbf{l}'}_1^\\top \\mathbf{x}'_2 \\right)\n",
    "     \\left( {\\mathbf{l}'}_2^\\top \\mathbf{x}'_1 \\right)\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left( \\mathbf{l}_1^\\top \\mathbf{H}^{-1} \\mathbf{H} \\mathbf{x}_1 \\right)\n",
    "     \\left( \\mathbf{l}_2^\\top \\mathbf{H}^{-1} \\mathbf{H} \\mathbf{x}_2 \\right)\n",
    "   }{\n",
    "     \\left( \\mathbf{l}_1^\\top \\mathbf{H}^{-1} \\mathbf{H} \\mathbf{x}_2 \\right)\n",
    "     \\left( \\mathbf{l}_2^\\top \\mathbf{H}^{-1} \\mathbf{H} \\mathbf{x}_1 \\right)\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left( \\mathbf{l}_1^\\top \\mathbf{x}_1 \\right)\n",
    "     \\left( \\mathbf{l}_2^\\top \\mathbf{x}_2 \\right)\n",
    "   }{\n",
    "     \\left( \\mathbf{l}_1^\\top \\mathbf{x}_2 \\right)\n",
    "     \\left( \\mathbf{l}_2^\\top \\mathbf{x}_1 \\right)\n",
    "   }.\n",
    "\n",
    "(b)\n",
    "---\n",
    "\n",
    "As shown in result 2.13, under a point transformation :math:`\\mathbf{H}`, a\n",
    "conic :math:`\\mathbf{C}` transforms to\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{C}' = \\mathbf{H}^{-\\top} \\mathbf{C} \\mathbf{H}^{-1}.\n",
    "\n",
    "Observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{\n",
    "     \\left(\n",
    "       {\\mathbf{x}'}_1^\\top \\mathbf{C}' \\mathbf{x}'_2\n",
    "     \\right)^2\n",
    "   }{\n",
    "     \\left( {\\mathbf{x}'}_1^\\top \\mathbf{C}' \\mathbf{x}'_1 \\right)\n",
    "     \\left( {\\mathbf{x}'}_2^\\top \\mathbf{C}' \\mathbf{x}'_2 \\right)\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left(\n",
    "       \\mathbf{x}_1 \\mathbf{H}^\\top\n",
    "       \\mathbf{H}^{-\\top} \\mathbf{C} \\mathbf{H}^{-1}\n",
    "       \\mathbf{H} \\mathbf{x}_2\n",
    "     \\right)^2\n",
    "   }{\n",
    "     \\left(\n",
    "       \\mathbf{x}_1 \\mathbf{H}^\\top\n",
    "       \\mathbf{H}^{-\\top} \\mathbf{C} \\mathbf{H}^{-1}\n",
    "       \\mathbf{H} \\mathbf{x}_1\n",
    "     \\right)\n",
    "     \\left(\n",
    "       \\mathbf{x}_2 \\mathbf{H}^\\top\n",
    "       \\mathbf{H}^{-\\top} \\mathbf{C} \\mathbf{H}^{-1}\n",
    "       \\mathbf{H} \\mathbf{x}_2\n",
    "     \\right)\n",
    "   } =\n",
    "   \\frac{\n",
    "     \\left( \\mathbf{x}_1 \\mathbf{C} \\mathbf{x}_2 \\right)^2\n",
    "   }{\n",
    "     \\left( \\mathbf{x}_1 \\mathbf{C} \\mathbf{x}_1 \\right)\n",
    "     \\left( \\mathbf{x}_2 \\mathbf{C} \\mathbf{x}_2 \\right)\n",
    "   }.\n",
    "\n",
    "(c)\n",
    "---\n",
    "\n",
    "As illustrated in Chapter 18 of :cite:`richter2011perspectives`, Laguerre's\n",
    "formula can be used to obtain the Euclidean angle between two lines that is\n",
    "invariant to the projective frame.\n",
    "\n",
    "Let :math:`\\mathbf{I} = \\begin{bmatrix} 1 & i & 0 \\end{bmatrix}^\\top` and\n",
    ":math:`\\mathbf{J} = \\begin{bmatrix} 1 & -i & 0 \\end{bmatrix}^\\top` denote the\n",
    "ideal circular points.  Let\n",
    ":math:`\\mathbf{l}_\\infty = \\begin{bmatrix} 0 & 0 & 1 \\end{bmatrix}^\\top`\n",
    "represent the line at infinity.  Define the intersection of the line at infinity\n",
    "and line :math:`\\mathbf{l}_j` for :math:`j = 1, 2` (result 2.2) as\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{p}_j =\n",
    "   \\mathbf{l}_j \\times \\mathbf{l}_\\infty =\n",
    "   \\begin{bmatrix} b_j & -a_j & 0 \\end{bmatrix}^\\top.\n",
    "\n",
    "Observe that :math:`\\mathbf{p}_j` is normal (orthogonal) to\n",
    ":math:`\\mathbf{l}_j`.  By inspection, the angle of these two normal vectors is\n",
    "the angle between the two lines.  Furthermore, scaling the normal vectors by\n",
    "a non-zero constant does not affect the angle.  These observations allow the\n",
    "2D normal vectors to be translated to two corresponding complex numbers\n",
    "\n",
    ".. math::\n",
    "\n",
    "   z_j =\n",
    "   a_j + i b_j =\n",
    "   r_j (\\cos \\theta_j + i \\sin \\theta_j) =\n",
    "   r_j \\exp i \\theta_j\n",
    "   \\quad \\land \\quad\n",
    "   \\overline{z_j} = a_j - i b_j = r_j \\exp -i \\theta_j\n",
    "\n",
    "without affecting the polar angle between them.  Evidently, the angle\n",
    ":math:`\\theta_1 - \\theta_2` modulo :math:`\\pi` is the desired Euclidean angle\n",
    "between the two lines, which can be extract from\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\frac{z_1 \\overline{z_2}}{\\overline{z_1} z_2} =\n",
    "   \\frac{\n",
    "     r_1 \\exp i \\theta_1 \\cdot r_2 \\exp -i \\theta_2\n",
    "   }{\n",
    "     r_1 \\exp -i \\theta_1 \\cdot r_2 \\exp i \\theta_2\n",
    "   } =\n",
    "   \\exp 2i (\\theta_1 - \\theta_2).\n",
    "\n",
    "Recall that there exists :math:`4! = 24` definitions of the cross ratio, but\n",
    "only six distinct values are produced.  Define the cross ratio to have the\n",
    "following ordering\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{Cross}\\left(\n",
    "     \\tilde{\\mathbf{p}}_1, \\tilde{\\mathbf{p}}_2, \\mathbf{I}, \\mathbf{J}\n",
    "   \\right) =\n",
    "   \\frac{\n",
    "     \\det\n",
    "       \\begin{bmatrix} \\tilde{\\mathbf{p}}_1 & \\tilde{\\mathbf{I}} \\end{bmatrix}\n",
    "     \\det\n",
    "       \\begin{bmatrix} \\tilde{\\mathbf{p}}_2 & \\tilde{\\mathbf{J}} \\end{bmatrix}\n",
    "   }{\n",
    "     \\det\n",
    "       \\begin{bmatrix} \\tilde{\\mathbf{p}}_1 & \\tilde{\\mathbf{J}} \\end{bmatrix}\n",
    "     \\det\n",
    "       \\begin{bmatrix} \\tilde{\\mathbf{p}}_2 & \\tilde{\\mathbf{I}} \\end{bmatrix}\n",
    "   } =\n",
    "   \\frac{\n",
    "     (i b_1 + a_1) (-i b_2 + a_2)\n",
    "   }{\n",
    "     (-i b_1 + a_1) (i b_2 + a_2)\n",
    "   } =\n",
    "   \\frac{z_1 \\overline{z_2}}{\\overline{z_1} z_2}\n",
    "\n",
    "where :math:`\\tilde{\\cdot}` denotes the corresponding inhomogenous coordinates.\n",
    "Therefore,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\theta_1 - \\theta_2 =\n",
    "   \\frac{1}{2i} \\ln\n",
    "     \\text{Cross}\\left(\n",
    "       \\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{I}, \\mathbf{J}\n",
    "     \\right)."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext",
    "scrolled": true
   },
   "source": [
    "(v) The Cross Ratio\n",
    "===================\n",
    "\n",
    "Let :math:`\\mathbf{x}_i \\in \\mathbb{R}^2` for :math:`i = 1, \\ldots, 4` denote\n",
    "four collinear points on a line in homogeneous coordinates.  Under a\n",
    "projectivity :math:`H \\in \\mathbb{R}^{2 \\times 2}`,\n",
    ":math:`\\mathbf{x}'_i = \\lambda_i \\mathbf{H} \\mathbf{x}_i`.\n",
    "\n",
    "Observe that\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\det \\begin{bmatrix} \\mathbf{x}'_i & \\mathbf{x}'_j \\end{bmatrix}\n",
    "    &= \\det \\begin{bmatrix}\n",
    "         \\lambda_i \\mathbf{H} \\mathbf{x}_i &\n",
    "         \\lambda_j \\mathbf{H} \\mathbf{x}_j\n",
    "       \\end{bmatrix}\\\\\n",
    "    &= \\det \\mathbf{H} \\begin{bmatrix}\n",
    "         \\lambda_i \\mathbf{x}_i & \\lambda_j \\mathbf{x}_j\n",
    "       \\end{bmatrix}\\\\\n",
    "    &= \\det(\\mathbf{H}) \\left(\n",
    "         \\lambda_i \\lambda_j \\mathbf{x}_{i1} \\mathbf{x}_{j2} -\n",
    "         \\lambda_i \\lambda_j \\mathbf{x}_{i2} \\mathbf{x}_{j1}\n",
    "       \\right)\\\\\n",
    "    &= \\lambda_i \\lambda_j \\det(\\mathbf{H})\n",
    "       \\begin{vmatrix} \\mathbf{x}_i & \\mathbf{x}_j \\end{vmatrix}.\n",
    "\n",
    "Therefore, the cross ratio (2.18)\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{Cross}\\left(\n",
    "     \\mathbf{x}'_1, \\mathbf{x}'_2, \\mathbf{x}'_3, \\mathbf{x}'_4\n",
    "   \\right)\n",
    "    &= \\frac{\n",
    "         \\begin{vmatrix} \\mathbf{x}'_1 & \\mathbf{x}'_2 \\end{vmatrix}\n",
    "         \\begin{vmatrix} \\mathbf{x}'_3 & \\mathbf{x}'_4 \\end{vmatrix}\n",
    "       }{\n",
    "         \\begin{vmatrix} \\mathbf{x}'_1 & \\mathbf{x}'_3 \\end{vmatrix}\n",
    "         \\begin{vmatrix} \\mathbf{x}'_2 & \\mathbf{x}'_4 \\end{vmatrix}\n",
    "       }\\\\\n",
    "    &= \\frac{\n",
    "         \\lambda_1 \\lambda_2 \\det(\\mathbf{H})\n",
    "           \\begin{vmatrix} \\mathbf{x}_1 & \\mathbf{x}_2 \\end{vmatrix} \\cdot\n",
    "         \\lambda_3 \\lambda_4 \\det(\\mathbf{H})\n",
    "           \\begin{vmatrix} \\mathbf{x}_3 & \\mathbf{x}_4 \\end{vmatrix}\n",
    "       }{\n",
    "         \\lambda_1 \\lambda_3 \\det(\\mathbf{H})\n",
    "           \\begin{vmatrix} \\mathbf{x}_1 & \\mathbf{x}_3 \\end{vmatrix} \\cdot\n",
    "         \\lambda_2 \\lambda_4 \\det(\\mathbf{H})\n",
    "           \\begin{vmatrix} \\mathbf{x}_2 & \\mathbf{x}_4 \\end{vmatrix}\n",
    "       }\\\\\n",
    "    &= \\frac{\n",
    "         \\begin{vmatrix} \\mathbf{x}_1 & \\mathbf{x}_2 \\end{vmatrix}\n",
    "         \\begin{vmatrix} \\mathbf{x}_3 & \\mathbf{x}_4 \\end{vmatrix}\n",
    "       }{\n",
    "         \\begin{vmatrix} \\mathbf{x}_1 & \\mathbf{x}_3 \\end{vmatrix}\n",
    "         \\begin{vmatrix} \\mathbf{x}_2 & \\mathbf{x}_4 \\end{vmatrix}\n",
    "       }\\\\\n",
    "    &= \\text{Cross}\\left(\n",
    "         \\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4\n",
    "       \\right)."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(vi) Polarity\n",
    "=============\n",
    "\n",
    "As illustrated in Figure 2.19, polarity is a geometric relation between a point,\n",
    "line, and conic.  Let :math:`\\mathbf{C}` denote an arbitrary conic (2.3).  The\n",
    "polar of any given point :math:`\\mathbf{x}` with respect to :math:`\\mathbf{C}`\n",
    "is :math:`\\mathbf{l} = \\mathbf{C} \\mathbf{x}`.  Likewise, the pole of any given\n",
    "line :math:`\\mathbf{m}` with respect to :math:`\\mathbf{C}` is\n",
    ":math:`\\mathbf{y} = \\mathbf{C}^{-1} \\mathbf{m}`.\n",
    "\n",
    "Let :math:`\\mathbf{l}_i` where :math:`i = 1, 2` denote different lines\n",
    "intersecting at a point :math:`\\mathbf{y}` inside the conic :math:`\\mathbf{C}`.\n",
    "The pole of line :math:`\\mathbf{l}_i` is\n",
    ":math:`\\mathbf{x}_i = \\mathbf{C}^{-1} \\mathbf{l}_i`.\n",
    "\n",
    "From the definition of conjugate points, since :math:`\\mathbf{y}` is on the\n",
    "polar of :math:`\\mathbf{x}_i`, :math:`\\mathbf{x}_i` is on the polar of\n",
    ":math:`\\mathbf{y}`.  Thus, the polar of :math:`\\mathbf{y}` is the line\n",
    ":math:`\\mathbf{m}` that goes through points\n",
    ":math:`\\mathbf{x}_1` and :math:`\\mathbf{x}_2` i.e.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{m} = \\mathbf{x}_1 \\times \\mathbf{x}_2 = \\mathbf{C} \\mathbf{y}."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(vii) Conics\n",
    "============\n",
    "\n",
    ":cite:`richter2011perspectives` presents in definition 9.3 a more general method\n",
    "of determining internal and external points with respect to a conic.\n",
    "\n",
    "    For a :math:`3 \\times 3` symmetric matrix :math:`\\mathbf{C}` with\n",
    "    :math:`\\det \\mathbf{C} \\neq 0`, a point :math:`\\mathbf{x}` is inside the\n",
    "    conic if the conic does not intersect the polar of :math:`\\mathbf{x}`.  If\n",
    "    the polar intersects the conic in two (real) points, then the point\n",
    "    :math:`\\mathbf{x}` is outside the conic."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(viii) Dual Conics\n",
    "==================\n",
    "\n",
    "Recall that if :math:`\\mathbf{l} = \\mathbf{x} \\times \\mathbf{y}`, then\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\left[ \\mathbf{l} \\right]_\\times =\n",
    "   \\mathbf{y} \\mathbf{x}^\\top - \\mathbf{x} \\mathbf{y}^\\top.\n",
    "\n",
    "Let :math:`\\mathbf{x}` and :math:`\\mathbf{y}` denote the points at which line\n",
    ":math:`\\mathbf{l}` intersects the conic :math:`\\mathbf{C}`.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{C}^* =\n",
    "   \\left[ \\mathbf{l} \\right]_\\times \\mathbf{C} \\left[ \\mathbf{l} \\right]_\\times\n",
    "    &= \\left( \\mathbf{y} \\mathbf{x}^\\top - \\mathbf{x} \\mathbf{y}^\\top \\right)\n",
    "       \\mathbf{C}\n",
    "       \\left( \\mathbf{y} \\mathbf{x}^\\top - \\mathbf{x} \\mathbf{y}^\\top \\right)\\\\\n",
    "    &= \\mathbf{y} \\mathbf{x}^\\top \\mathbf{C} \\mathbf{y} \\mathbf{x}^\\top -\n",
    "       \\mathbf{y} \\mathbf{x}^\\top \\mathbf{C} \\mathbf{x} \\mathbf{y}^\\top -\n",
    "       \\mathbf{x} \\mathbf{y}^\\top \\mathbf{C} \\mathbf{y} \\mathbf{x}^\\top +\n",
    "       \\mathbf{x} \\mathbf{y}^\\top \\mathbf{C} \\mathbf{x} \\mathbf{y}^\\top\\\\\n",
    "    &= \\mathbf{y} \\mathbf{x}^\\top \\mathbf{C} \\mathbf{y} \\mathbf{x}^\\top +\n",
    "       \\mathbf{x} \\mathbf{y}^\\top \\mathbf{C} \\mathbf{x} \\mathbf{y}^\\top\n",
    "       & \\quad & (2.2)\\\\\n",
    "    &= \\alpha \\mathbf{y} \\mathbf{x}^\\top + \\alpha \\mathbf{x} \\mathbf{y}^\\top\n",
    "       \\quad \\text{where} \\quad\n",
    "       \\alpha = \\mathbf{x}^\\top \\mathbf{C} \\mathbf{y} =\n",
    "         \\mathbf{y}^\\top \\mathbf{C} \\mathbf{x}.\n",
    "\n",
    "The rank of :math:`\\mathbf{C}^*` is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{rank}(\\mathbf{C}^*) =\n",
    "   \\text{rank}(\\mathbf{y} \\mathbf{x}^\\top + \\mathbf{x} \\mathbf{y}^\\top) \\leq\n",
    "   \\text{rank}(\\mathbf{y} \\mathbf{x}^\\top) +\n",
    "     \\text{rank}(\\mathbf{x} \\mathbf{y}^\\top) = 1 + 1 = 2.\n",
    "\n",
    "Applying the duality principle (result 2.6) to the definition of degenerate\n",
    "conics shows that :math:`\\mathbf{C}^*` is a dual conic."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "(ix) Special Projective Transformations\n",
    "=======================================\n",
    "\n",
    ":cite:`schreiber2013reflections` has a much better exposition on the concept of\n",
    "harmonic homology (see definition 2.2, Figure 6, Section 7).\n",
    "\n",
    "When the points are related by a finite rotational symmetry of order :math:`n`,\n",
    "each point is on an axis of reflection.  Let :math:`\\mathbf{a}_i` denote an axis\n",
    "of reflection in homogeneous coordinates with unit length.  For each consecutive\n",
    "pair of axes :math:`(i, j)`,\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{a}_i \\times \\mathbf{a}_j = \\mathbf{c} = \\mathbf{n} \\sin \\theta\n",
    "   \\quad \\land \\quad\n",
    "   \\mathbf{a}_i^\\top \\mathbf{a}_j = \\cos \\theta\n",
    "\n",
    "where :math:`\\mathbf{c}` is the center of rotation,\n",
    ":math:`\\theta = \\frac{360}{n}` is the angle between the axes, and\n",
    ":math:`\\mathbf{n}` is the axis of rotation.\n",
    "\n",
    "The corresponding reflection matrix for each axis is\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_i = \\mathbf{I} - 2 \\mathbf{a}_i \\mathbf{a}_i^\\top.\n",
    "\n",
    "By inspection, :math:`\\mathbf{H}_i = \\mathbf{H}_i^\\top` and\n",
    ":math:`\\mathbf{H}_i \\mathbf{H}_i^\\top =\n",
    "\\mathbf{H}_i^\\top \\mathbf{H}_i = \\mathbf{I}`.  Observe that the product of any\n",
    "two reflection matrix is a rotation matrix because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{H}_i \\mathbf{H}_j \\left( \\mathbf{H}_i \\mathbf{H}_j \\right)^\\top =\n",
    "   \\mathbf{H}_i \\mathbf{H}_j \\mathbf{H}_j^\\top \\mathbf{H}_i^\\top =\n",
    "   \\mathbf{H}_i \\mathbf{H}_i^\\top =\n",
    "   \\mathbf{I}.\n",
    "\n",
    "The angle of a rotation matrix can be computed according to :cite:`haberph216`\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\text{tr}\\left( \\mathbf{H}_i \\mathbf{H}_j \\right)\n",
    "    &= \\text{tr}\\left(\n",
    "         \\mathbf{I} - 2 \\mathbf{a}_i \\mathbf{a}_i^\\top -\n",
    "         2 \\mathbf{a}_j \\mathbf{a}_j^\\top +\n",
    "         4 \\mathbf{a}_i \\mathbf{a}_i^\\top \\mathbf{a}_j \\mathbf{a}_j^\\top\n",
    "       \\right)\\\\\n",
    "   1 + 2 \\cos \\phi\n",
    "    &= 3 - 2 - 2 + 4 \\cos^{2} \\theta\\\\\n",
    "   \\cos \\phi &= -1 + 2 \\cos^{2} \\theta\\\\\n",
    "    &= \\cos 2 \\theta & \\quad & \\text{double-angle formula}.\n",
    "\n",
    "Let :math:`\\mathbf{R} = \\mathbf{H}_i \\mathbf{H}_j` denote a rotation formed by\n",
    "any consecutive pair of reflections.  Recall that repeatedly applying the same\n",
    "rotation is equivalent to a single rotation representing the sum of the angles.\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{R}^n \\implies n \\phi = n \\cdot 2 \\theta = 2n \\frac{360}{n} = 720.\n",
    "\n",
    "Lastly, the center of rotation is an eigenvector because\n",
    "\n",
    ".. math::\n",
    "\n",
    "   \\mathbf{R} \\mathbf{c} =\n",
    "   \\mathbf{H}_i \\mathbf{H}_j \\mathbf{c} =\n",
    "   \\mathbf{H}_i \\mathbf{c} =\n",
    "   \\mathbf{c}."
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    ".. rubric:: References\n",
    "\n",
    ".. bibliography:: chapter-02.bib"
   ]
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "celltoolbar": "Raw Cell Format",
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
